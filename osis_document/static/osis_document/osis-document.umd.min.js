(function(c,p){typeof exports=="object"&&typeof module<"u"?p(require("@vue/runtime-dom"),require("vue-i18n"),require("vue")):typeof define=="function"&&define.amd?define(["@vue/runtime-dom","vue-i18n","vue"],p):(c=typeof globalThis<"u"?globalThis:c||self,p(c.Vue,c.VueI18n,c.Vue))})(this,function(c,p,n){"use strict";const E={uploader:{specific_nb_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(["Glissez-déposez ici un fichier"]),t(["Glissez-déposez ici ",o(r("count"))," fichiers"])])},min_max_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["Glissez-déposez ici entre ",o(r("min"))," et ",o(r("max"))," fichiers"])},min_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(["Glissez-déposez ici au-moins un fichier"]),t(["Glissez-déposez ici au-moins ",o(r("count"))," fichiers"])])},max_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(["Glissez-déposez ici votre fichier"]),t(["Glissez-déposez ici vos fichiers (maximum ",o(r("count")),")"])])},drag_n_drop_label:e=>{const{normalize:t}=e;return t(["Glissez-déposez ici vos fichiers"])},add_file_label:e=>{const{normalize:t}=e;return t(["ou cliquez-ici"])},max_size_label:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["(taille maximum ",o(r("size")),")"])},trigger_upload:e=>{const{normalize:t}=e;return t(["Transférer"])}},upload_entry:{completion:e=>{const{normalize:t,interpolate:o,named:r}=e;return t([o(r("progress")),"% transférés"])},too_large:e=>{const{normalize:t}=e;return t(["Le fichier est trop lourd"])},wrong_type:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(['Le fichier doit être du type "',o(r("types")),'"']),t([`Le fichier doit être d'un des types suivants : "`,o(r("types")),'"'])])}},view_entry:{rotate_left:e=>{const{normalize:t}=e;return t(["Faire pivoter l'image à gauche"])},rotate_right:e=>{const{normalize:t}=e;return t(["Faire pivoter l'image à droite"])},loading:e=>{const{normalize:t}=e;return t(["Chargement..."])},close:e=>{const{normalize:t}=e;return t(["Fermer"])},save:e=>{const{normalize:t}=e;return t(["Enregistrer"])},file_infected:e=>{const{normalize:t}=e;return t(["Le fichier référencé semble infecté par un virus"])}},editor:{pagination:e=>{const{normalize:t,interpolate:o,named:r}=e;return t([o(r("currentPage"))," de ",o(r("pages"))])},zoom:{auto:e=>{const{normalize:t}=e;return t(["Zoom automatique"])},"page-width":e=>{const{normalize:t}=e;return t(["Pleine largeur"])},"page-fit":e=>{const{normalize:t}=e;return t(["Page entière"])},"page-actual":e=>{const{normalize:t}=e;return t(["Taille réelle"])}},colors:{warning:e=>{const{normalize:t}=e;return t(["Jaune"])},danger:e=>{const{normalize:t}=e;return t(["Rouge"])},info:e=>{const{normalize:t}=e;return t(["Bleu"])},success:e=>{const{normalize:t}=e;return t(["Vert"])},muted:e=>{const{normalize:t}=e;return t(["Blanc"])}}},error:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["Erreur : ",o(r("error"))])},request_error:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["Erreur lors de la requête : ",o(r("error"))])},units:[e=>{const{normalize:t}=e;return t(["o"])},e=>{const{normalize:t}=e;return t(["Ko"])},e=>{const{normalize:t}=e;return t(["Mo"])},e=>{const{normalize:t}=e;return t(["Go"])},e=>{const{normalize:t}=e;return t(["To"])}]},N={uploader:{specific_nb_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(["Drag and drop one file here"]),t(["Drag and drop ",o(r("count"))," files here"])])},min_max_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["Drag and drop between ",o(r("min"))," and ",o(r("max"))," files here"])},min_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(["Drag and drop at least one file here"]),t(["Drag and drop at least ",o(r("count"))," files here"])])},max_drag_n_drop_label:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(["Drag and drop your file here"]),t(["Drag and drop your files here (maximum ",o(r("count")),")"])])},drag_n_drop_label:e=>{const{normalize:t}=e;return t(["Drag and drop your files here"])},add_file_label:e=>{const{normalize:t}=e;return t(["or click here"])},max_size_label:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["(max size ",o(r("size")),")"])},trigger_upload:e=>{const{normalize:t}=e;return t(["Upload"])}},upload_entry:{completion:e=>{const{normalize:t,interpolate:o,named:r}=e;return t([o(r("progress")),"% uploaded"])},too_large:e=>{const{normalize:t}=e;return t(["File is too large"])},wrong_type:e=>{const{normalize:t,interpolate:o,named:r,plural:i}=e;return i([t(['The file must have the following type: "',o(r("types")),'"']),t(['The file must have one of the following types: "',o(r("types")),'"'])])}},view_entry:{rotate_left:e=>{const{normalize:t}=e;return t(["Rotate image left"])},rotate_right:e=>{const{normalize:t}=e;return t(["Rotate image right"])},loading:e=>{const{normalize:t}=e;return t(["Loading..."])},close:e=>{const{normalize:t}=e;return t(["Close"])},save:e=>{const{normalize:t}=e;return t(["Save"])},file_infected:e=>{const{normalize:t}=e;return t(["The referenced file appears to be infected with a virus"])}},editor:{pagination:e=>{const{normalize:t,interpolate:o,named:r}=e;return t([o(r("currentPage"))," of ",o(r("pages"))])},zoom:{auto:e=>{const{normalize:t}=e;return t(["Automatic Zoom"])},"page-width":e=>{const{normalize:t}=e;return t(["Page Width"])},"page-fit":e=>{const{normalize:t}=e;return t(["Page Fit"])},"page-actual":e=>{const{normalize:t}=e;return t(["Actual Size"])}},colors:{warning:e=>{const{normalize:t}=e;return t(["Yellow"])},danger:e=>{const{normalize:t}=e;return t(["Red"])},info:e=>{const{normalize:t}=e;return t(["Blue"])},success:e=>{const{normalize:t}=e;return t(["Green"])},muted:e=>{const{normalize:t}=e;return t(["White"])}}},error:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["Error: ",o(r("error"))])},request_error:e=>{const{normalize:t,interpolate:o,named:r}=e;return t(["Request error: ",o(r("error"))])},units:[e=>{const{normalize:t}=e;return t(["B"])},e=>{const{normalize:t}=e;return t(["KB"])},e=>{const{normalize:t}=e;return t(["MB"])},e=>{const{normalize:t}=e;return t(["GB"])},e=>{const{normalize:t}=e;return t(["TB"])}]},f=p.createI18n({locale:document.documentElement.lang||"en",allowComposition:!0,messages:{en:N,fr:E}});function _(e){let t=0;for(;e>=1024;)e/=1024,++t;const o=f.global.t(`units[${t}]`);return`${e.toFixed(2)} ${o}`}async function u(e,t){const o=await fetch(e,{headers:{"Content-Type":"application/json"},...t});if(o.status>=200&&o.status<300)return o.json();throw new Error(o.statusText)}var y={},V={get exports(){return y},set exports(e){y=e}};function b(){}b.prototype={on:function(e,t,o){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:o}),this},once:function(e,t,o){var r=this;function i(){r.off(e,i),t.apply(o,arguments)}return i._=t,this.on(e,i,o)},emit:function(e){var t=[].slice.call(arguments,1),o=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=o.length;for(r;r<i;r++)o[r].fn.apply(o[r].ctx,t);return this},off:function(e,t){var o=this.e||(this.e={}),r=o[e],i=[];if(r&&t)for(var m=0,s=r.length;m<s;m++)r[m].fn!==t&&r[m].fn._!==t&&i.push(r[m]);return i.length?o[e]=i:delete o[e],this}},V.exports=b;var P=y.TinyEmitter=b;const z=new P,S=n.defineComponent({name:"UploadEntry",props:{file:{type:File,required:!0},baseUrl:{type:String,required:!0},maxSize:{type:Number,default:0},mimetypes:{type:Array,default:()=>[]},automatic:{type:Boolean,default:!0}},emits:{setToken(e){return e.length>0},delete(){return!0}},data(){return{progress:0,token:"",error:""}},computed:{isImage:function(){return this.file.type.split("/")[0]==="image"},fileUrl:function(){return URL.createObjectURL(this.file)},humanizedSize:function(){return _(this.file.size)}},mounted(){this.maxSize&&this.file.size>this.maxSize?this.error=this.$t("upload_entry.too_large"):this.mimetypes.length&&!this.mimetypes.includes(this.file.type)?this.error=this.$tc("upload_entry.wrong_type",this.mimetypes.length,{types:this.mimetypes.join(", ")}):this.automatic?this.sendFile():z.on("upload",this.sendFile)},methods:{revokeUrl:function(e){URL.revokeObjectURL(e)},sendFile:function(){const e=new XMLHttpRequest;e.upload.addEventListener("progress",o=>{this.progress=Math.round(o.loaded*100/o.total)},!1),e.open("POST",`${this.baseUrl}request-upload`,!0),e.addEventListener("readystatechange",()=>{if(e.readyState===4&&e.status>=200&&e.status<=300){const o=JSON.parse(e.responseText);this.$emit("setToken",o.token)}else{let o;try{o=JSON.parse(e.responseText).detail}catch{o=e.statusText}this.error=this.$t("request_error",{error:o})}});const t=new FormData;t.append("file",this.file),e.send(t)}}}),h=(e,t)=>{const o=e.__vccOpts||e;for(const[r,i]of t)o[r]=i;return o},B={class:"media"},w={key:0,class:"media-left"},U=["src","alt"],F={class:"media-body"},D={class:"media-heading"},T={class:"text-nowrap"},C={key:0,class:"progress"},q=["aria-valuenow"],L={class:"sr-only"},R={key:1,class:"text-danger"},O={class:"media-right"},j=[n.createElementVNode("span",{class:"fas fa-trash-alt"},null,-1)];function I(e,t,o,r,i,m){return n.openBlock(),n.createElementBlock("li",B,[e.isImage?(n.openBlock(),n.createElementBlock("div",w,[n.createElementVNode("img",{class:"media-object img-thumbnail",src:e.fileUrl,alt:e.file.name,width:"80",onLoad:t[0]||(t[0]=s=>e.revokeUrl(e.fileUrl))},null,40,U)])):n.createCommentVNode("",!0),n.createElementVNode("div",F,[n.createElementVNode("h4",D,[n.createTextVNode(n.toDisplayString(e.file.name)+" ",1),n.createElementVNode("small",null,[n.createElementVNode("span",T,n.toDisplayString(e.humanizedSize),1),n.createTextVNode(" ("+n.toDisplayString(e.file.type)+")",1)])]),e.error?(n.openBlock(),n.createElementBlock("span",R,n.toDisplayString(e.error),1)):(n.openBlock(),n.createElementBlock("div",C,[n.createElementVNode("div",{class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":e.progress,"aria-valuemin":"0","aria-valuemax":"100",style:n.normalizeStyle({width:`${e.progress}%`})},[n.createElementVNode("span",L,n.toDisplayString(e.$t("upload_entry.completion",{progress:e.progress})),1)],12,q)]))]),n.createElementVNode("div",O,[n.createElementVNode("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=s=>e.$emit("delete"))},j)])])}const H=h(S,[["render",I]]),M=n.defineComponent({name:"ViewingModal",props:{baseUrl:{type:String,required:!0},value:{type:String,required:!0},id:{type:String,required:!0},file:{type:Object,required:!0},isEditable:{type:Boolean,default:!0},openOnMount:{type:Boolean,default:!1}},emits:{updateToken(e){return e.length>0}},data:function(){return{rotation:0,originalHeight:null,originalWidth:null,modalHeight:"auto",modalWidth:"auto",error:"",saved:!1}},computed:{isImage:function(){return this.file.mimetype.split("/")[0]==="image"},imageStyle:function(){let e=`rotate(${this.rotation}deg)`;this.isQuarterRotated?e+=` translate(${this.isRotated90CounterClockwise?"-50%":"50%"}, -50%)`:this.isRotated&&(e+=" translate(0, -100%)");const t=this.$refs.modal,o=this.originalHeight&&this.isQuarterRotated&&t.clientWidth<this.originalHeight?`${t.clientWidth-30}px`:"auto";return{transform:e,height:o}},isRotated:function(){return this.rotation%360},isQuarterRotated:function(){return this.rotation%180},isRotated90CounterClockwise:function(){return[-90,270].includes(this.rotation%360)}},watch:{rotation:"changeModalHeight"},mounted(){jQuery(this.$el).on("shown.bs.modal",()=>{this.originalHeight||this.imageLoaded(this.$refs.img),this.changeModalHeight()}),this.openOnMount&&jQuery(this.$el).modal("show")},beforeUnmount(){jQuery(this.$el).modal("hide")},methods:{imageLoaded:async function(e){await n.nextTick(),this.originalHeight=e.clientHeight,this.originalWidth=e.clientWidth,this.changeModalHeight()},changeModalHeight:function(){if(!this.originalWidth||!this.originalHeight)return"auto";const e=this.$refs.modal;this.isQuarterRotated&&e.clientWidth<this.originalHeight?this.modalHeight=`${e.clientWidth*this.originalWidth/this.originalHeight+30}px`:this.modalHeight=`${(this.isQuarterRotated?this.originalWidth:this.originalHeight)+30}px`},saveRotation:async function(){try{const e=await u(`${this.baseUrl}rotate-image/${this.value}`,{method:"POST",body:JSON.stringify({rotate:this.rotation})});this.saved=!0,this.rotation=0,this.$emit("updateToken",e.token),this.error=""}catch(e){this.error=e.message}}}}),A=["id"],G={class:"modal-dialog modal-lg",role:"document"},W={class:"modal-content"},Q={class:"modal-header"},J=["aria-label"],K=[n.createElementVNode("span",{"aria-hidden":"true"},"×",-1)],Z={class:"modal-title"},X=["src","alt"],Y={key:1,class:"embed-responsive embed-responsive-16by9"},v=["data"],x=["src"],ee={class:"modal-footer"},te={class:"row"},ne={key:0,class:"col-sm-10 text-left"},oe=[n.createElementVNode("i",{class:"fas fa-undo"},null,-1)],re=[n.createElementVNode("i",{class:"fas fa-redo"},null,-1)],ie=["disabled"],se={key:0,class:"text-danger"},ae={class:"col-sm-2 pull-right"},le={type:"button",class:"btn btn-default","data-dismiss":"modal"};function de(e,t,o,r,i,m){return n.openBlock(),n.createElementBlock("div",{id:`modal-${e.id}`,class:"modal fade",tabindex:"-1",role:"dialog"},[n.createElementVNode("div",G,[n.createElementVNode("div",W,[n.createElementVNode("div",Q,[n.createElementVNode("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":e.$t("view_entry.close")},K,8,J),n.createElementVNode("h4",Z,n.toDisplayString(e.file.name),1)]),n.createElementVNode("div",{ref:"modal",class:"modal-body",style:n.normalizeStyle([{transition:"500ms",overflow:"hidden","max-width":"100%"},{height:e.modalHeight}])},[e.isImage?(n.openBlock(),n.createElementBlock("img",{key:0,ref:"img",src:e.file.url,alt:e.file.name,class:"img-responsive",style:n.normalizeStyle([{transition:"500ms","transform-origin":"top center",margin:"0 auto"},e.imageStyle]),onLoad:t[0]||(t[0]=s=>e.imageLoaded(s.target))},null,44,X)):(n.openBlock(),n.createElementBlock("div",Y,[n.createElementVNode("object",{data:e.file.url,type:"application/pdf",class:"embed-responsive-item"},[n.createElementVNode("embed",{src:e.file.url,type:"application/pdf"},null,8,x)],8,v)]))],4),n.createElementVNode("div",ee,[n.createElementVNode("div",te,[e.isImage&&e.isEditable?(n.openBlock(),n.createElementBlock("div",ne,[n.createElementVNode("button",{type:"button",class:"btn btn-default",onClick:t[1]||(t[1]=s=>e.rotation-=90)},oe),n.createElementVNode("button",{type:"button",class:"btn btn-default",onClick:t[2]||(t[2]=s=>e.rotation+=90)},re),n.createElementVNode("button",{type:"button",class:"btn btn-default",disabled:!e.isRotated,onClick:t[3]||(t[3]=(...s)=>e.saveRotation&&e.saveRotation(...s))},[n.createElementVNode("i",{class:n.normalizeClass(`fas fa-${e.saved?"check":"save"}`)},null,2),n.createTextVNode(" "+n.toDisplayString(e.$t("view_entry.save")),1)],8,ie),e.error?(n.openBlock(),n.createElementBlock("span",se,n.toDisplayString(e.$t("error",{error:e.error})),1)):n.createCommentVNode("",!0)])):n.createCommentVNode("",!0),n.createElementVNode("div",ae,[n.createElementVNode("button",le,n.toDisplayString(e.$t("view_entry.close")),1)])])])])])],8,A)}const me=h(M,[["render",de]]),ce=n.defineComponent({name:"ViewEntry",components:{ViewingModal:me},props:{value:{type:String,required:!0},id:{type:String,required:!0},baseUrl:{type:String,required:!0},isEditable:{type:Boolean,default:!0},editableFilename:{type:Boolean,default:!0},getProgressUrl:{type:String,default:""},postProcessStatus:{type:String,default:""},baseUuid:{type:String,default:""},wantedPostProcess:{type:String,default:""}},emits:{updateToken(e){return e.length>0},delete(){return!0}},data(){return{file:null,loading:!0,inPostProcessing:!1,postProcessingProgress:0,error:"",name:"",extension:"",saved:!1,intervalProgress:setInterval(()=>{},3e5),getRemoteTokenResponse:{token:""}}},computed:{isImage:function(){var e;return((e=this.file)==null?void 0:e.mimetype.split("/")[0])==="image"},isViewableDocument:function(){const e=this.file.mimetype;return e.split("/")[0]==="image"||e==="application/pdf"},formattedValue:function(){return this.value.replace(/:/g,"-")},fullName:{get(){return`${this.name}${this.extension}`},set:function(e){const t=/^(.+)(\.[^.]+)$/.exec(e);(t==null?void 0:t.length)===3?(this.name=t[1],this.extension=t[2]):(this.name=e,this.extension="")}}},watch:{value:"getFile"},mounted(){this.getFile()},updated(){this.inPostProcessing&&((this.getProgressUrl!==""||this.getProgressUrl!==void 0)&&this.postProcessingProgress!==100&&(clearInterval(this.intervalProgress),this.intervalProgress=setInterval(()=>{this.getProgressPostProcessing()},3e3)),this.postProcessingProgress===100&&(clearInterval(this.intervalProgress),this.inPostProcessing=!1,this.getFile()))},unmounted(){clearInterval(this.intervalProgress)},methods:{humanizedSize:_,getFile:async function(){if(this.value==="FileInfectedException")this.error=this.$t("view_entry.file_infected");else if(this.value===""&&this.postProcessingProgress!==100)this.inPostProcessing=!0,await this.getProgressPostProcessing();else{if(this.value===""){let t=JSON.stringify({uuid:this.baseUuid});(this.wantedPostProcess===""||this.wantedPostProcess===void 0)&&(t=JSON.stringify({uuid:this.baseUuid,wanted_post_process:this.wantedPostProcess})),this.getRemoteTokenResponse=await u(`${this.baseUrl}read-token/${this.baseUuid}`,{method:"POST",body:t})}const e=this.getRemoteTokenResponse.token!==""?`${this.baseUrl}metadata/${this.getRemoteTokenResponse.token}`:`${this.baseUrl}metadata/${this.value}`;try{this.file=await u(e),this.fullName=this.file.name}catch(t){this.error=t.message}}this.loading=!1,console.log("loading est false")},getProgressPostProcessing:async function(){/* istanbul ignore if -- @preserve */if(this.postProcessingProgress!==100&&this.getProgressUrl!=="")try{let e="";this.wantedPostProcess?e=this.getProgressUrl+"?wanted_post_process="+this.wantedPostProcess:e=this.getProgressUrl;const t=await u(`${e}`,{method:"GET"});this.postProcessingProgress=t.progress}catch(e){this.error=e.message}},saveName:async function(){try{await u(`${this.baseUrl}change-metadata/${this.value}`,{method:"POST",body:JSON.stringify({name:this.fullName})}),this.saved=!0,this.file.name=this.fullName}catch(e){this.error=e.message}}}}),pe={class:"media"},ue={key:0,class:"media-body"},he={class:"progress"},ge={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},fe={class:"sr-only"},_e={key:1,class:"media-body"},ye={class:"progress",style:{"text-align":"center"}},be={class:"sr-only"},ze={class:"align-items-center"},$e={class:"media-body"},ke={class:"text-danger"},Ee={class:"media-right text-right"},Ne=[n.createElementVNode("span",{class:"fas fa-trash-alt"},null,-1)],Ve={key:0,class:"media-left"},Pe=["src","alt"],Se={class:"media-body"},Be={class:"media-heading"},we={key:0,class:"input-group"},Ue={key:0,class:"input-group-addon"},Fe={class:"input-group-btn"},De=["disabled"],Te={key:1},Ce={class:"text-nowrap"},qe={class:"btn-group"},Le=["data-target"],Re=[n.createElementVNode("span",{class:"fas fa-eye"},null,-1)],Oe=["href"],je=[n.createElementVNode("span",{class:"fas fa-download"},null,-1)],Ie=[n.createElementVNode("span",{class:"fas fa-trash-alt"},null,-1)];function He(e,t,o,r,i,m){const s=n.resolveComponent("ViewingModal");return n.openBlock(),n.createElementBlock("li",pe,[e.loading?(n.openBlock(),n.createElementBlock("div",ue,[n.createElementVNode("div",he,[n.createElementVNode("div",ge,[n.createElementVNode("span",fe,n.toDisplayString(e.$t("view_entry.loading")),1)])])])):e.inPostProcessing?(n.openBlock(),n.createElementBlock("div",_e,[n.createElementVNode("div",ye,[n.createElementVNode("div",{class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:n.normalizeStyle({width:e.postProcessingProgress.toString()+"%"})},[n.createElementVNode("span",be,n.toDisplayString(e.$t("view_entry.loading")),1)],4),n.createElementVNode("span",ze,"Avancement du post processing : "+n.toDisplayString(e.postProcessingProgress)+" %",1)])])):e.error?(n.openBlock(),n.createElementBlock(n.Fragment,{key:2},[n.createElementVNode("div",$e,[n.createElementVNode("span",ke,n.toDisplayString(e.$t("error",{error:e.error})),1)]),n.createElementVNode("div",Ee,[e.isEditable?(n.openBlock(),n.createElementBlock("button",{key:0,class:"btn btn-danger",type:"button",onClick:t[0]||(t[0]=d=>e.$emit("delete"))},Ne)):n.createCommentVNode("",!0)])],64)):e.file?(n.openBlock(),n.createElementBlock(n.Fragment,{key:3},[e.isImage?(n.openBlock(),n.createElementBlock("div",Ve,[n.createElementVNode("img",{class:"media-object img-thumbnail",src:e.file.url,alt:e.file.name,width:"80"},null,8,Pe)])):n.createCommentVNode("",!0),n.createElementVNode("div",Se,[n.createElementVNode("h4",Be,[e.isEditable&&e.editableFilename?(n.openBlock(),n.createElementBlock("div",we,[n.withDirectives(n.createElementVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>e.name=d),type:"text",class:"form-control",onInput:t[2]||(t[2]=d=>e.saved=!1)},null,544),[[n.vModelText,e.name]]),e.extension?(n.openBlock(),n.createElementBlock("span",Ue,n.toDisplayString(e.extension),1)):n.createCommentVNode("",!0),n.createElementVNode("span",Fe,[n.createElementVNode("button",{type:"button",disabled:e.file.name===e.fullName,class:"btn btn-default",onClick:t[3]||(t[3]=(...d)=>e.saveName&&e.saveName(...d))},[n.createElementVNode("i",{class:n.normalizeClass(`fas fa-${e.saved?"check":"save"}`)},null,2)],8,De)])])):(n.openBlock(),n.createElementBlock("div",Te,n.toDisplayString(e.file.name),1)),n.createElementVNode("small",null,[n.createElementVNode("span",Ce,n.toDisplayString(e.humanizedSize(e.file.size)),1),n.createTextVNode(" ("+n.toDisplayString(e.file.mimetype)+")",1)])])]),n.createElementVNode("div",{class:"media-right text-right",style:n.normalizeStyle({"min-width":e.isViewableDocument?"9.5em":"7em"})},[n.createElementVNode("div",qe,[e.isViewableDocument?(n.openBlock(),n.createElementBlock("a",{key:0,class:"btn btn-default","data-toggle":"modal","data-target":`#modal-${e.formattedValue}`},Re,8,Le)):n.createCommentVNode("",!0),n.createElementVNode("a",{class:"btn btn-default",target:"_blank",href:`${e.file.url}?dl=1`},je,8,Oe),e.isEditable?(n.openBlock(),n.createElementBlock("button",{key:1,class:"btn btn-danger",type:"button",onClick:t[4]||(t[4]=d=>e.$emit("delete"))},Ie)):n.createCommentVNode("",!0)])],4),e.isViewableDocument?(n.openBlock(),n.createBlock(s,{key:1,id:e.formattedValue,file:e.file,"is-editable":e.isEditable,value:e.value,"base-url":e.baseUrl,onUpdateToken:t[5]||(t[5]=d=>e.$emit("updateToken",d))},null,8,["id","file","is-editable","value","base-url"])):n.createCommentVNode("",!0)],64)):n.createCommentVNode("",!0)])}const $=h(ce,[["render",He]]),Me="osisdocument:",Ae="add",Ge="delete",We=n.defineComponent({name:"DocumentUploader",components:{UploadEntry:H,ViewEntry:$},props:{name:{type:String,required:!0},baseUrl:{type:String,required:!0},uploadText:{type:String,default:null},uploadButtonText:{type:String,default:null},maxSize:{type:Number,default:0},automaticUpload:{type:Boolean,default:!0},editableFilename:{type:Boolean,default:!0},values:{type:Array,default:()=>[]},mimetypes:{type:Array,default:()=>[]},minFiles:{type:Number,default:0},maxFiles:{type:Number,default:0}},data(){let e=0;return{isDragging:!1,fileList:{},tokens:Object.fromEntries(this.values.map(t=>(e++,[e,t]))),indexGenerated:e}},computed:{filteredTokens:function(){return Object.fromEntries(Object.entries(this.tokens).filter(e=>!!e[1]))},cleanedTokens:function(){return Object.fromEntries(Object.entries(this.tokens).filter(e=>!!e[1]&&!["FileInfectedException","UploadInvalidException"].includes(e[1])))},nbUploadedFiles:function(){return Object.values(this.cleanedTokens).length},dragNDropLabel:function(){return this.minFiles?this.minFiles===this.maxFiles?this.$tc("uploader.specific_nb_drag_n_drop_label",this.minFiles):this.maxFiles?this.$t("uploader.min_max_drag_n_drop_label",{min:this.minFiles,max:this.maxFiles}):this.$tc("uploader.min_drag_n_drop_label",this.minFiles):this.maxFiles?this.$tc("uploader.max_drag_n_drop_label",this.maxFiles):this.$t("uploader.drag_n_drop_label")}},watch:{cleanedTokens:{handler(e,t){if(JSON.stringify(t)!==JSON.stringify(e)){const o=Object.keys(t).length>Object.keys(e).length?Ge:Ae,r=new CustomEvent(Me+o,{bubbles:!0,detail:{newTokens:e,oldTokens:t}});this.$el.dispatchEvent(r)}}}},mounted(){jQuery("> input",this.$el).on("change",e=>{jQuery(e.target).val()||(this.tokens={})})},methods:{humanizedSize:_,triggerUpload(){z.emit("upload")},onFilePicked(e){const t=e.target.files;t&&Array.from(t).forEach(o=>{this.indexGenerated++,this.fileList[this.indexGenerated]=o,this.tokens[this.indexGenerated]=null}),this.isDragging=!1}}}),ut="",Qe=["accept"],Je=n.createElementVNode("span",{class:"glyphicon glyphicon-plus"},null,-1),Ke={key:0},Ze={key:1,class:"media-list"},Xe={key:2,class:"text-right form-group"},Ye={class:"media-list"},ve=["name","value"];function xe(e,t,o,r,i,m){const s=n.resolveComponent("UploadEntry"),d=n.resolveComponent("ViewEntry");return n.openBlock(),n.createElementBlock(n.Fragment,null,[e.maxFiles===0||e.nbUploadedFiles<e.maxFiles?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(["dropzone form-group",{hovering:e.isDragging}]),onDragenter:t[3]||(t[3]=a=>e.isDragging=!0)},[n.createElementVNode("input",{ref:"fileInput",type:"file",multiple:"",accept:e.mimetypes.length?e.mimetypes.join(","):void 0,onDragleave:t[0]||(t[0]=a=>e.isDragging=!1),onChange:t[1]||(t[1]=(...a)=>e.onFilePicked&&e.onFilePicked(...a))},null,40,Qe),n.createTextVNode(" "+n.toDisplayString(e.uploadText||e.dragNDropLabel)+" ",1),n.createElementVNode("button",{class:"btn btn-default",type:"button",onClick:t[2]||(t[2]=a=>e.$refs.fileInput.click())},[Je,n.createTextVNode(" "+n.toDisplayString(e.uploadButtonText||e.$t("uploader.add_file_label")),1)]),e.maxSize?(n.openBlock(),n.createElementBlock("span",Ke,n.toDisplayString(e.$t("uploader.max_size_label",{size:e.humanizedSize(e.maxSize)})),1)):n.createCommentVNode("",!0)],34)):n.createCommentVNode("",!0),e.fileList?(n.openBlock(),n.createElementBlock("ul",Ze,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.fileList,(a,l)=>(n.openBlock(),n.createBlock(s,{key:l,file:a,"base-url":e.baseUrl,"max-size":e.maxSize,mimetypes:e.mimetypes,automatic:e.automaticUpload,onDelete:g=>{delete e.fileList[l],delete e.tokens[l]},onSetToken:g=>{e.tokens[l]=g,delete e.fileList[l]}},null,8,["file","base-url","max-size","mimetypes","automatic","onDelete","onSetToken"]))),128))])):n.createCommentVNode("",!0),!e.automaticUpload&&Object.values(e.fileList).length?(n.openBlock(),n.createElementBlock("div",Xe,[n.createElementVNode("button",{class:"btn btn-default",type:"button",onClick:t[4]||(t[4]=(...a)=>e.triggerUpload&&e.triggerUpload(...a))},n.toDisplayString(e.$t("uploader.trigger_upload")),1)])):n.createCommentVNode("",!0),n.createElementVNode("ul",Ye,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.filteredTokens,(a,l)=>(n.openBlock(),n.createBlock(d,{id:`${e.name}-${l}`,key:l,value:a,"base-url":e.baseUrl,editable:!0,"editable-filename":e.editableFilename,onDelete:g=>delete e.tokens[l],onUpdateToken:g=>e.tokens[l]=g},null,8,["id","value","base-url","editable-filename","onDelete","onUpdateToken"]))),128))]),(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(Object.values(e.cleanedTokens),(a,l)=>(n.openBlock(),n.createElementBlock("input",{key:`${e.name}_${l}`,type:"hidden",name:`${e.name}_${l}`,value:a},null,8,ve))),128))],64)}const et=h(We,[["render",xe]]),tt=n.defineComponent({name:"DocumentVisualizer",components:{ViewEntry:$},props:{baseUrl:{type:String,required:!0},values:{type:Array,required:!0},postProcessStatus:{type:String,required:!0},getProgressUrl:{type:String,required:!0},baseUuid:{type:String,required:!0},wantedPostProcess:{type:String,required:!0}}}),nt={class:"media-list"};function ot(e,t,o,r,i,m){const s=n.resolveComponent("ViewEntry");return n.openBlock(),n.createElementBlock("ul",nt,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.values,(d,a)=>(n.openBlock(),n.createBlock(s,{id:a.toString(),key:a,value:d,"base-url":e.baseUrl,"is-editable":!1,"get-progress-url":e.getProgressUrl,"post-process-status":e.postProcessStatus,"base-uuid":e.baseUuid,"wanted-post-process":e.wantedPostProcess},null,8,["id","value","base-url","get-progress-url","post-process-status","base-uuid","wanted-post-process"]))),128))])}const rt=h(tt,[["render",ot]]);function k(){document.querySelectorAll(".osis-document-uploader:not([data-v-app])").forEach(e=>{const t={baseUrl:"",...e.dataset};typeof e.dataset.maxSize<"u"&&(t.maxSize=Number.parseInt(e.dataset.maxSize)),typeof e.dataset.minFiles<"u"&&(t.minFiles=Number.parseInt(e.dataset.minFiles)),typeof e.dataset.maxFiles<"u"&&(t.maxFiles=Number.parseInt(e.dataset.maxFiles)),typeof e.dataset.mimetypes<"u"&&(t.mimetypes=e.dataset.mimetypes.split(",")),typeof e.dataset.values<"u"&&(t.values=e.dataset.values.split(",")),typeof e.dataset.automaticUpload<"u"&&(t.automaticUpload=e.dataset.automaticUpload==="true"),typeof e.dataset.editableFilename<"u"&&(t.editableFilename=e.dataset.editableFilename==="true"),c.createApp(et,t).use(f).mount(e)}),document.querySelectorAll(".osis-document-visualizer:not([data-v-app])").forEach(e=>{const t={baseUrl:"",values:[],postProcessStatus:"",getProgressUrl:"",baseUuid:"",wantedPostProcess:"",...e.dataset};typeof e.dataset.values<"u"&&(t.values=e.dataset.values.split(",")),typeof e.dataset.postProcessStatus<"u"&&(t.postProcessStatus=e.dataset.postProcessStatus),typeof e.dataset.getProgressUrl<"u"&&(t.getProgressUrl=e.dataset.getProgressUrl),typeof e.dataset.baseUuid<"u"&&(t.baseUuid=e.dataset.baseUuid),typeof e.dataset.wantedPostProcess<"u"&&(t.wantedPostProcess=e.dataset.wantedPostProcess),c.createApp(rt,t).use(f).mount(e)})}k(),new MutationObserver(k).observe(document,{childList:!0,subtree:!0})});
//# sourceMappingURL=osis-document.umd.min.js.map
