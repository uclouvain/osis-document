(function(I,ae){typeof exports=="object"&&typeof module<"u"?ae(require("@vue/runtime-dom"),require("vue-i18n"),require("vue")):typeof define=="function"&&define.amd?define(["@vue/runtime-dom","vue-i18n","vue"],ae):(I=typeof globalThis<"u"?globalThis:I||self,ae(I.Vue,I.VueI18n,I.Vue))})(this,function(I,ae,n){"use strict";const Nt={uploader:{specific_nb_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(["Glissez-déposez ici un fichier"]),e(["Glissez-déposez ici ",a(i("count"))," fichiers"])])},min_max_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["Glissez-déposez ici entre ",a(i("min"))," et ",a(i("max"))," fichiers"])},min_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(["Glissez-déposez ici au-moins un fichier"]),e(["Glissez-déposez ici au-moins ",a(i("count"))," fichiers"])])},max_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(["Glissez-déposez ici votre fichier"]),e(["Glissez-déposez ici vos fichiers (maximum ",a(i("count")),")"])])},drag_n_drop_label:t=>{const{normalize:e}=t;return e(["Glissez-déposez ici vos fichiers"])},add_file_label:t=>{const{normalize:e}=t;return e(["ou cliquez-ici"])},max_size_label:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["(taille maximum ",a(i("size")),")"])},trigger_upload:t=>{const{normalize:e}=t;return e(["Transférer"])}},upload_entry:{completion:t=>{const{normalize:e,interpolate:a,named:i}=t;return e([a(i("progress")),"% transférés"])},too_large:t=>{const{normalize:e}=t;return e(["Le fichier est trop lourd"])},wrong_type:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(['Le fichier doit être du type "',a(i("types")),'"']),e([`Le fichier doit être d'un des types suivants : "`,a(i("types")),'"'])])},crop_header:t=>{const{normalize:e}=t;return e(["Veuillez choisir la partie à garder."])},crop:t=>{const{normalize:e}=t;return e(["Recadrer"])},cancel:t=>{const{normalize:e}=t;return e(["Annuler"])}},view_entry:{rotate_left:t=>{const{normalize:e}=t;return e(["Faire pivoter l'image à gauche"])},rotate_right:t=>{const{normalize:e}=t;return e(["Faire pivoter l'image à droite"])},loading:t=>{const{normalize:e}=t;return e(["Chargement..."])},close:t=>{const{normalize:e}=t;return e(["Fermer"])},save:t=>{const{normalize:e}=t;return e(["Enregistrer"])},file_infected:t=>{const{normalize:e}=t;return e(["Le fichier référencé semble infecté par un virus"])}},editor:{pagination:t=>{const{normalize:e,interpolate:a,named:i}=t;return e([a(i("currentPage"))," de ",a(i("pages"))])},zoom:{auto:t=>{const{normalize:e}=t;return e(["Zoom automatique"])},"page-width":t=>{const{normalize:e}=t;return e(["Pleine largeur"])},"page-fit":t=>{const{normalize:e}=t;return e(["Page entière"])},"page-actual":t=>{const{normalize:e}=t;return e(["Taille réelle"])}},colors:{warning:t=>{const{normalize:e}=t;return e(["Jaune"])},danger:t=>{const{normalize:e}=t;return e(["Rouge"])},info:t=>{const{normalize:e}=t;return e(["Bleu"])},success:t=>{const{normalize:e}=t;return e(["Vert"])},muted:t=>{const{normalize:e}=t;return e(["Blanc"])}}},error:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["Erreur : ",a(i("error"))])},request_error:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["Erreur lors de la requête : ",a(i("error"))])},units:[t=>{const{normalize:e}=t;return e(["o"])},t=>{const{normalize:e}=t;return e(["Ko"])},t=>{const{normalize:e}=t;return e(["Mo"])},t=>{const{normalize:e}=t;return e(["Go"])},t=>{const{normalize:e}=t;return e(["To"])}]},Ct={uploader:{specific_nb_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(["Drag and drop one file here"]),e(["Drag and drop ",a(i("count"))," files here"])])},min_max_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["Drag and drop between ",a(i("min"))," and ",a(i("max"))," files here"])},min_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(["Drag and drop at least one file here"]),e(["Drag and drop at least ",a(i("count"))," files here"])])},max_drag_n_drop_label:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(["Drag and drop your file here"]),e(["Drag and drop your files here (maximum ",a(i("count")),")"])])},drag_n_drop_label:t=>{const{normalize:e}=t;return e(["Drag and drop your files here"])},add_file_label:t=>{const{normalize:e}=t;return e(["or click here"])},max_size_label:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["(max size ",a(i("size")),")"])},trigger_upload:t=>{const{normalize:e}=t;return e(["Upload"])}},upload_entry:{completion:t=>{const{normalize:e,interpolate:a,named:i}=t;return e([a(i("progress")),"% uploaded"])},too_large:t=>{const{normalize:e}=t;return e(["File is too large"])},wrong_type:t=>{const{normalize:e,interpolate:a,named:i,plural:o}=t;return o([e(['The file must have the following type: "',a(i("types")),'"']),e(['The file must have one of the following types: "',a(i("types")),'"'])])},crop_header:t=>{const{normalize:e}=t;return e(["Please choose the part you want to keep."])},crop:t=>{const{normalize:e}=t;return e(["Crop"])},cancel:t=>{const{normalize:e}=t;return e(["Cancel"])}},view_entry:{rotate_left:t=>{const{normalize:e}=t;return e(["Rotate image left"])},rotate_right:t=>{const{normalize:e}=t;return e(["Rotate image right"])},loading:t=>{const{normalize:e}=t;return e(["Loading..."])},close:t=>{const{normalize:e}=t;return e(["Close"])},save:t=>{const{normalize:e}=t;return e(["Save"])},file_infected:t=>{const{normalize:e}=t;return e(["The referenced file appears to be infected with a virus"])}},editor:{pagination:t=>{const{normalize:e,interpolate:a,named:i}=t;return e([a(i("currentPage"))," of ",a(i("pages"))])},zoom:{auto:t=>{const{normalize:e}=t;return e(["Automatic Zoom"])},"page-width":t=>{const{normalize:e}=t;return e(["Page Width"])},"page-fit":t=>{const{normalize:e}=t;return e(["Page Fit"])},"page-actual":t=>{const{normalize:e}=t;return e(["Actual Size"])}},colors:{warning:t=>{const{normalize:e}=t;return e(["Yellow"])},danger:t=>{const{normalize:e}=t;return e(["Red"])},info:t=>{const{normalize:e}=t;return e(["Blue"])},success:t=>{const{normalize:e}=t;return e(["Green"])},muted:t=>{const{normalize:e}=t;return e(["White"])}}},error:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["Error: ",a(i("error"))])},request_error:t=>{const{normalize:e,interpolate:a,named:i}=t;return e(["Request error: ",a(i("error"))])},units:[t=>{const{normalize:e}=t;return e(["B"])},t=>{const{normalize:e}=t;return e(["KB"])},t=>{const{normalize:e}=t;return e(["MB"])},t=>{const{normalize:e}=t;return e(["GB"])},t=>{const{normalize:e}=t;return e(["TB"])}]},be=ae.createI18n({locale:document.documentElement.lang||"en",allowComposition:!0,messages:{en:Ct,fr:Nt}});function ve(t){let e=0;for(;t>=1024;)t/=1024,++e;const a=be.global.t(`units[${e}]`);return`${t.toFixed(2)} ${a}`}async function re(t,e){const a=await fetch(t,{headers:{"Content-Type":"application/json"},...e});if(a.status>=200&&a.status<300)return a.json();throw new Error(a.statusText)}var we={},St={get exports(){return we},set exports(t){we=t}};function _e(){}_e.prototype={on:function(t,e,a){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:a}),this},once:function(t,e,a){var i=this;function o(){i.off(t,o),e.apply(a,arguments)}return o._=e,this.on(t,o,a)},emit:function(t){var e=[].slice.call(arguments,1),a=((this.e||(this.e={}))[t]||[]).slice(),i=0,o=a.length;for(i;i<o;i++)a[i].fn.apply(a[i].ctx,e);return this},off:function(t,e){var a=this.e||(this.e={}),i=a[t],o=[];if(i&&e)for(var r=0,s=i.length;r<s;r++)i[r].fn!==e&&i[r].fn._!==e&&o.push(i[r]);return o.length?a[t]=o:delete a[t],this}},St.exports=_e;var Tt=we.TinyEmitter=_e;const Ie=new Tt;/*!
 * Cropper.js v1.6.1
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-09-17T03:44:19.860Z
 */function He(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,i)}return a}function Fe(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?He(Object(a),!0).forEach(function(i){Bt(t,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):He(Object(a)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(a,i))})}return t}function Ee(t){return Ee=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ee(t)}function $t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function We(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Ye(i.key),i)}}function Mt(t,e,a){return e&&We(t.prototype,e),a&&We(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bt(t,e,a){return e=Ye(e),e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function je(t){return xt(t)||Ot(t)||Pt(t)||Vt()}function xt(t){if(Array.isArray(t))return ze(t)}function Ot(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Pt(t,e){if(t){if(typeof t=="string")return ze(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ze(t,e)}}function ze(t,e){(e==null||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function Vt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rt(t,e){if(typeof t!="object"||t===null)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var i=a.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ye(t){var e=Rt(t,"string");return typeof e=="symbol"?e:String(e)}var me=typeof window<"u"&&typeof window.document<"u",V=me?window:{},De=me&&V.document.documentElement?"ontouchstart"in V.document.documentElement:!1,ke=me?"PointerEvent"in V:!1,w="cropper",Ne="all",Xe="crop",qe="move",Ge="zoom",Y="e",X="w",K="s",H="n",ne="ne",oe="nw",se="se",le="sw",Ce="".concat(w,"-crop"),Qe="".concat(w,"-disabled"),T="".concat(w,"-hidden"),Je="".concat(w,"-hide"),At="".concat(w,"-invisible"),ue="".concat(w,"-modal"),Se="".concat(w,"-move"),he="".concat(w,"Action"),fe="".concat(w,"Preview"),Te="crop",Ke="move",Ze="none",$e="crop",Me="cropend",Be="cropmove",xe="cropstart",et="dblclick",Ut=De?"touchstart":"mousedown",Lt=De?"touchmove":"mousemove",It=De?"touchend touchcancel":"mouseup",tt=ke?"pointerdown":Ut,it=ke?"pointermove":Lt,at=ke?"pointerup pointercancel":It,rt="ready",nt="resize",ot="wheel",Oe="zoom",st="image/jpeg",Ht=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Ft=/^data:/,Wt=/^data:image\/jpeg;base64,/,jt=/^img|canvas$/i,lt=200,ht=100,dt={viewMode:0,dragMode:Te,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:lt,minContainerHeight:ht,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Yt='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Xt=Number.isNaN||V.isNaN;function f(t){return typeof t=="number"&&!Xt(t)}var ct=function(e){return e>0&&e<1/0};function Pe(t){return typeof t>"u"}function q(t){return Ee(t)==="object"&&t!==null}var qt=Object.prototype.hasOwnProperty;function Z(t){if(!q(t))return!1;try{var e=t.constructor,a=e.prototype;return e&&a&&qt.call(a,"isPrototypeOf")}catch{return!1}}function $(t){return typeof t=="function"}var Gt=Array.prototype.slice;function pt(t){return Array.from?Array.from(t):Gt.call(t)}function z(t,e){return t&&$(e)&&(Array.isArray(t)||f(t.length)?pt(t).forEach(function(a,i){e.call(t,a,i,t)}):q(t)&&Object.keys(t).forEach(function(a){e.call(t,t[a],a,t)})),t}var _=Object.assign||function(e){for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return q(e)&&i.length>0&&i.forEach(function(r){q(r)&&Object.keys(r).forEach(function(s){e[s]=r[s]})}),e},Qt=/\.\d*(?:0|9){12}\d*$/;function ee(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Qt.test(t)?Math.round(t*e)/e:t}var Jt=/^width|height|left|top|marginLeft|marginTop$/;function F(t,e){var a=t.style;z(e,function(i,o){Jt.test(o)&&f(i)&&(i="".concat(i,"px")),a[o]=i})}function Kt(t,e){return t.classList?t.classList.contains(e):t.className.indexOf(e)>-1}function C(t,e){if(e){if(f(t.length)){z(t,function(i){C(i,e)});return}if(t.classList){t.classList.add(e);return}var a=t.className.trim();a?a.indexOf(e)<0&&(t.className="".concat(a," ").concat(e)):t.className=e}}function R(t,e){if(e){if(f(t.length)){z(t,function(a){R(a,e)});return}if(t.classList){t.classList.remove(e);return}t.className.indexOf(e)>=0&&(t.className=t.className.replace(e,""))}}function te(t,e,a){if(e){if(f(t.length)){z(t,function(i){te(i,e,a)});return}a?C(t,e):R(t,e)}}var Zt=/([a-z\d])([A-Z])/g;function Ve(t){return t.replace(Zt,"$1-$2").toLowerCase()}function Re(t,e){return q(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute("data-".concat(Ve(e)))}function de(t,e,a){q(a)?t[e]=a:t.dataset?t.dataset[e]=a:t.setAttribute("data-".concat(Ve(e)),a)}function ei(t,e){if(q(t[e]))try{delete t[e]}catch{t[e]=void 0}else if(t.dataset)try{delete t.dataset[e]}catch{t.dataset[e]=void 0}else t.removeAttribute("data-".concat(Ve(e)))}var mt=/\s\s*/,ut=function(){var t=!1;if(me){var e=!1,a=function(){},i=Object.defineProperty({},"once",{get:function(){return t=!0,e},set:function(r){e=r}});V.addEventListener("test",a,i),V.removeEventListener("test",a,i)}return t}();function P(t,e,a){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},o=a;e.trim().split(mt).forEach(function(r){if(!ut){var s=t.listeners;s&&s[r]&&s[r][a]&&(o=s[r][a],delete s[r][a],Object.keys(s[r]).length===0&&delete s[r],Object.keys(s).length===0&&delete t.listeners)}t.removeEventListener(r,o,i)})}function x(t,e,a){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},o=a;e.trim().split(mt).forEach(function(r){if(i.once&&!ut){var s=t.listeners,l=s===void 0?{}:s;o=function(){delete l[r][a],t.removeEventListener(r,o,i);for(var c=arguments.length,h=new Array(c),d=0;d<c;d++)h[d]=arguments[d];a.apply(t,h)},l[r]||(l[r]={}),l[r][a]&&t.removeEventListener(r,l[r][a],i),l[r][a]=o,t.listeners=l}t.addEventListener(r,o,i)})}function ie(t,e,a){var i;return $(Event)&&$(CustomEvent)?i=new CustomEvent(e,{detail:a,bubbles:!0,cancelable:!0}):(i=document.createEvent("CustomEvent"),i.initCustomEvent(e,!0,!0,a)),t.dispatchEvent(i)}function ft(t){var e=t.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var Ae=V.location,ti=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function gt(t){var e=t.match(ti);return e!==null&&(e[1]!==Ae.protocol||e[2]!==Ae.hostname||e[3]!==Ae.port)}function yt(t){var e="timestamp=".concat(new Date().getTime());return t+(t.indexOf("?")===-1?"?":"&")+e}function ce(t){var e=t.rotate,a=t.scaleX,i=t.scaleY,o=t.translateX,r=t.translateY,s=[];f(o)&&o!==0&&s.push("translateX(".concat(o,"px)")),f(r)&&r!==0&&s.push("translateY(".concat(r,"px)")),f(e)&&e!==0&&s.push("rotate(".concat(e,"deg)")),f(a)&&a!==1&&s.push("scaleX(".concat(a,")")),f(i)&&i!==1&&s.push("scaleY(".concat(i,")"));var l=s.length?s.join(" "):"none";return{WebkitTransform:l,msTransform:l,transform:l}}function ii(t){var e=Fe({},t),a=0;return z(t,function(i,o){delete e[o],z(e,function(r){var s=Math.abs(i.startX-r.startX),l=Math.abs(i.startY-r.startY),p=Math.abs(i.endX-r.endX),c=Math.abs(i.endY-r.endY),h=Math.sqrt(s*s+l*l),d=Math.sqrt(p*p+c*c),m=(d-h)/h;Math.abs(m)>Math.abs(a)&&(a=m)})}),a}function ge(t,e){var a=t.pageX,i=t.pageY,o={endX:a,endY:i};return e?o:Fe({startX:a,startY:i},o)}function ai(t){var e=0,a=0,i=0;return z(t,function(o){var r=o.startX,s=o.startY;e+=r,a+=s,i+=1}),e/=i,a/=i,{pageX:e,pageY:a}}function W(t){var e=t.aspectRatio,a=t.height,i=t.width,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=ct(i),s=ct(a);if(r&&s){var l=a*e;o==="contain"&&l>i||o==="cover"&&l<i?a=i/e:i=a*e}else r?a=i/e:s&&(i=a*e);return{width:i,height:a}}function ri(t){var e=t.width,a=t.height,i=t.degree;if(i=Math.abs(i)%180,i===90)return{width:a,height:e};var o=i%90*Math.PI/180,r=Math.sin(o),s=Math.cos(o),l=e*s+a*r,p=e*r+a*s;return i>90?{width:p,height:l}:{width:l,height:p}}function ni(t,e,a,i){var o=e.aspectRatio,r=e.naturalWidth,s=e.naturalHeight,l=e.rotate,p=l===void 0?0:l,c=e.scaleX,h=c===void 0?1:c,d=e.scaleY,m=d===void 0?1:d,y=a.aspectRatio,g=a.naturalWidth,E=a.naturalHeight,b=i.fillColor,k=b===void 0?"transparent":b,S=i.imageSmoothingEnabled,D=S===void 0?!0:S,U=i.imageSmoothingQuality,B=U===void 0?"low":U,u=i.maxWidth,v=u===void 0?1/0:u,N=i.maxHeight,O=N===void 0?1/0:N,L=i.minWidth,G=L===void 0?0:L,Q=i.minHeight,j=Q===void 0?0:Q,A=document.createElement("canvas"),M=A.getContext("2d"),J=W({aspectRatio:y,width:v,height:O}),ye=W({aspectRatio:y,width:G,height:j},"cover"),Ue=Math.min(J.width,Math.max(ye.width,g)),Le=Math.min(J.height,Math.max(ye.height,E)),Et=W({aspectRatio:o,width:v,height:O}),zt=W({aspectRatio:o,width:G,height:j},"cover"),Dt=Math.min(Et.width,Math.max(zt.width,r)),kt=Math.min(Et.height,Math.max(zt.height,s)),sr=[-Dt/2,-kt/2,Dt,kt];return A.width=ee(Ue),A.height=ee(Le),M.fillStyle=k,M.fillRect(0,0,Ue,Le),M.save(),M.translate(Ue/2,Le/2),M.rotate(p*Math.PI/180),M.scale(h,m),M.imageSmoothingEnabled=D,M.imageSmoothingQuality=B,M.drawImage.apply(M,[t].concat(je(sr.map(function(lr){return Math.floor(ee(lr))})))),M.restore(),A}var bt=String.fromCharCode;function oi(t,e,a){var i="";a+=e;for(var o=e;o<a;o+=1)i+=bt(t.getUint8(o));return i}var si=/^data:.*,/;function li(t){var e=t.replace(si,""),a=atob(e),i=new ArrayBuffer(a.length),o=new Uint8Array(i);return z(o,function(r,s){o[s]=a.charCodeAt(s)}),i}function hi(t,e){for(var a=[],i=8192,o=new Uint8Array(t);o.length>0;)a.push(bt.apply(null,pt(o.subarray(0,i)))),o=o.subarray(i);return"data:".concat(e,";base64,").concat(btoa(a.join("")))}function di(t){var e=new DataView(t),a;try{var i,o,r;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var s=e.byteLength,l=2;l+1<s;){if(e.getUint8(l)===255&&e.getUint8(l+1)===225){o=l;break}l+=1}if(o){var p=o+4,c=o+10;if(oi(e,p,4)==="Exif"){var h=e.getUint16(c);if(i=h===18761,(i||h===19789)&&e.getUint16(c+2,i)===42){var d=e.getUint32(c+4,i);d>=8&&(r=c+d)}}}if(r){var m=e.getUint16(r,i),y,g;for(g=0;g<m;g+=1)if(y=r+g*12+2,e.getUint16(y,i)===274){y+=8,a=e.getUint16(y,i),e.setUint16(y,1,i);break}}}catch{a=1}return a}function ci(t){var e=0,a=1,i=1;switch(t){case 2:a=-1;break;case 3:e=-180;break;case 4:i=-1;break;case 5:e=90,i=-1;break;case 6:e=90;break;case 7:e=90,a=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:a,scaleY:i}}var pi={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,a=this.options,i=this.container,o=this.cropper,r=Number(a.minContainerWidth),s=Number(a.minContainerHeight);C(o,T),R(e,T);var l={width:Math.max(i.offsetWidth,r>=0?r:lt),height:Math.max(i.offsetHeight,s>=0?s:ht)};this.containerData=l,F(o,{width:l.width,height:l.height}),C(e,T),R(o,T)},initCanvas:function(){var e=this.containerData,a=this.imageData,i=this.options.viewMode,o=Math.abs(a.rotate)%180===90,r=o?a.naturalHeight:a.naturalWidth,s=o?a.naturalWidth:a.naturalHeight,l=r/s,p=e.width,c=e.height;e.height*l>e.width?i===3?p=e.height*l:c=e.width/l:i===3?c=e.width/l:p=e.height*l;var h={aspectRatio:l,naturalWidth:r,naturalHeight:s,width:p,height:c};this.canvasData=h,this.limited=i===1||i===2,this.limitCanvas(!0,!0),h.width=Math.min(Math.max(h.width,h.minWidth),h.maxWidth),h.height=Math.min(Math.max(h.height,h.minHeight),h.maxHeight),h.left=(e.width-h.width)/2,h.top=(e.height-h.height)/2,h.oldLeft=h.left,h.oldTop=h.top,this.initialCanvasData=_({},h)},limitCanvas:function(e,a){var i=this.options,o=this.containerData,r=this.canvasData,s=this.cropBoxData,l=i.viewMode,p=r.aspectRatio,c=this.cropped&&s;if(e){var h=Number(i.minCanvasWidth)||0,d=Number(i.minCanvasHeight)||0;l>1?(h=Math.max(h,o.width),d=Math.max(d,o.height),l===3&&(d*p>h?h=d*p:d=h/p)):l>0&&(h?h=Math.max(h,c?s.width:0):d?d=Math.max(d,c?s.height:0):c&&(h=s.width,d=s.height,d*p>h?h=d*p:d=h/p));var m=W({aspectRatio:p,width:h,height:d});h=m.width,d=m.height,r.minWidth=h,r.minHeight=d,r.maxWidth=1/0,r.maxHeight=1/0}if(a)if(l>(c?0:1)){var y=o.width-r.width,g=o.height-r.height;r.minLeft=Math.min(0,y),r.minTop=Math.min(0,g),r.maxLeft=Math.max(0,y),r.maxTop=Math.max(0,g),c&&this.limited&&(r.minLeft=Math.min(s.left,s.left+(s.width-r.width)),r.minTop=Math.min(s.top,s.top+(s.height-r.height)),r.maxLeft=s.left,r.maxTop=s.top,l===2&&(r.width>=o.width&&(r.minLeft=Math.min(0,y),r.maxLeft=Math.max(0,y)),r.height>=o.height&&(r.minTop=Math.min(0,g),r.maxTop=Math.max(0,g))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=o.width,r.maxTop=o.height},renderCanvas:function(e,a){var i=this.canvasData,o=this.imageData;if(a){var r=ri({width:o.naturalWidth*Math.abs(o.scaleX||1),height:o.naturalHeight*Math.abs(o.scaleY||1),degree:o.rotate||0}),s=r.width,l=r.height,p=i.width*(s/i.naturalWidth),c=i.height*(l/i.naturalHeight);i.left-=(p-i.width)/2,i.top-=(c-i.height)/2,i.width=p,i.height=c,i.aspectRatio=s/l,i.naturalWidth=s,i.naturalHeight=l,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,F(this.canvas,_({width:i.width,height:i.height},ce({translateX:i.left,translateY:i.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var a=this.canvasData,i=this.imageData,o=i.naturalWidth*(a.width/a.naturalWidth),r=i.naturalHeight*(a.height/a.naturalHeight);_(i,{width:o,height:r,left:(a.width-o)/2,top:(a.height-r)/2}),F(this.image,_({width:i.width,height:i.height},ce(_({translateX:i.left,translateY:i.top},i)))),e&&this.output()},initCropBox:function(){var e=this.options,a=this.canvasData,i=e.aspectRatio||e.initialAspectRatio,o=Number(e.autoCropArea)||.8,r={width:a.width,height:a.height};i&&(a.height*i>a.width?r.height=r.width/i:r.width=r.height*i),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*o),r.height=Math.max(r.minHeight,r.height*o),r.left=a.left+(a.width-r.width)/2,r.top=a.top+(a.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=_({},r)},limitCropBox:function(e,a){var i=this.options,o=this.containerData,r=this.canvasData,s=this.cropBoxData,l=this.limited,p=i.aspectRatio;if(e){var c=Number(i.minCropBoxWidth)||0,h=Number(i.minCropBoxHeight)||0,d=l?Math.min(o.width,r.width,r.width+r.left,o.width-r.left):o.width,m=l?Math.min(o.height,r.height,r.height+r.top,o.height-r.top):o.height;c=Math.min(c,o.width),h=Math.min(h,o.height),p&&(c&&h?h*p>c?h=c/p:c=h*p:c?h=c/p:h&&(c=h*p),m*p>d?m=d/p:d=m*p),s.minWidth=Math.min(c,d),s.minHeight=Math.min(h,m),s.maxWidth=d,s.maxHeight=m}a&&(l?(s.minLeft=Math.max(0,r.left),s.minTop=Math.max(0,r.top),s.maxLeft=Math.min(o.width,r.left+r.width)-s.width,s.maxTop=Math.min(o.height,r.top+r.height)-s.height):(s.minLeft=0,s.minTop=0,s.maxLeft=o.width-s.width,s.maxTop=o.height-s.height))},renderCropBox:function(){var e=this.options,a=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,e.movable&&e.cropBoxMovable&&de(this.face,he,i.width>=a.width&&i.height>=a.height?qe:Ne),F(this.cropBox,_({width:i.width,height:i.height},ce({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),ie(this.element,$e,this.getData())}},mi={initPreview:function(){var e=this.element,a=this.crossOrigin,i=this.options.preview,o=a?this.crossOriginUrl:this.url,r=e.alt||"The image to preview",s=document.createElement("img");if(a&&(s.crossOrigin=a),s.src=o,s.alt=r,this.viewBox.appendChild(s),this.viewBoxImage=s,!!i){var l=i;typeof i=="string"?l=e.ownerDocument.querySelectorAll(i):i.querySelector&&(l=[i]),this.previews=l,z(l,function(p){var c=document.createElement("img");de(p,fe,{width:p.offsetWidth,height:p.offsetHeight,html:p.innerHTML}),a&&(c.crossOrigin=a),c.src=o,c.alt=r,c.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',p.innerHTML="",p.appendChild(c)})}},resetPreview:function(){z(this.previews,function(e){var a=Re(e,fe);F(e,{width:a.width,height:a.height}),e.innerHTML=a.html,ei(e,fe)})},preview:function(){var e=this.imageData,a=this.canvasData,i=this.cropBoxData,o=i.width,r=i.height,s=e.width,l=e.height,p=i.left-a.left-e.left,c=i.top-a.top-e.top;!this.cropped||this.disabled||(F(this.viewBoxImage,_({width:s,height:l},ce(_({translateX:-p,translateY:-c},e)))),z(this.previews,function(h){var d=Re(h,fe),m=d.width,y=d.height,g=m,E=y,b=1;o&&(b=m/o,E=r*b),r&&E>y&&(b=y/r,g=o*b,E=y),F(h,{width:g,height:E}),F(h.getElementsByTagName("img")[0],_({width:s*b,height:l*b},ce(_({translateX:-p*b,translateY:-c*b},e))))}))}},ui={bind:function(){var e=this.element,a=this.options,i=this.cropper;$(a.cropstart)&&x(e,xe,a.cropstart),$(a.cropmove)&&x(e,Be,a.cropmove),$(a.cropend)&&x(e,Me,a.cropend),$(a.crop)&&x(e,$e,a.crop),$(a.zoom)&&x(e,Oe,a.zoom),x(i,tt,this.onCropStart=this.cropStart.bind(this)),a.zoomable&&a.zoomOnWheel&&x(i,ot,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&x(i,et,this.onDblclick=this.dblclick.bind(this)),x(e.ownerDocument,it,this.onCropMove=this.cropMove.bind(this)),x(e.ownerDocument,at,this.onCropEnd=this.cropEnd.bind(this)),a.responsive&&x(window,nt,this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,a=this.options,i=this.cropper;$(a.cropstart)&&P(e,xe,a.cropstart),$(a.cropmove)&&P(e,Be,a.cropmove),$(a.cropend)&&P(e,Me,a.cropend),$(a.crop)&&P(e,$e,a.crop),$(a.zoom)&&P(e,Oe,a.zoom),P(i,tt,this.onCropStart),a.zoomable&&a.zoomOnWheel&&P(i,ot,this.onWheel,{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&P(i,et,this.onDblclick),P(e.ownerDocument,it,this.onCropMove),P(e.ownerDocument,at,this.onCropEnd),a.responsive&&P(window,nt,this.onResize)}},fi={resize:function(){if(!this.disabled){var e=this.options,a=this.container,i=this.containerData,o=a.offsetWidth/i.width,r=a.offsetHeight/i.height,s=Math.abs(o-1)>Math.abs(r-1)?o:r;if(s!==1){var l,p;e.restore&&(l=this.getCanvasData(),p=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(z(l,function(c,h){l[h]=c*s})),this.setCropBoxData(z(p,function(c,h){p[h]=c*s})))}}},dblclick:function(){this.disabled||this.options.dragMode===Ze||this.setDragMode(Kt(this.dragBox,Ce)?Ke:Te)},wheel:function(e){var a=this,i=Number(this.options.wheelZoomRatio)||.1,o=1;this.disabled||(e.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){a.wheeling=!1},50),e.deltaY?o=e.deltaY>0?1:-1:e.wheelDelta?o=-e.wheelDelta/120:e.detail&&(o=e.detail>0?1:-1),this.zoom(-o*i,e)))},cropStart:function(e){var a=e.buttons,i=e.button;if(!(this.disabled||(e.type==="mousedown"||e.type==="pointerdown"&&e.pointerType==="mouse")&&(f(a)&&a!==1||f(i)&&i!==0||e.ctrlKey))){var o=this.options,r=this.pointers,s;e.changedTouches?z(e.changedTouches,function(l){r[l.identifier]=ge(l)}):r[e.pointerId||0]=ge(e),Object.keys(r).length>1&&o.zoomable&&o.zoomOnTouch?s=Ge:s=Re(e.target,he),Ht.test(s)&&ie(this.element,xe,{originalEvent:e,action:s})!==!1&&(e.preventDefault(),this.action=s,this.cropping=!1,s===Xe&&(this.cropping=!0,C(this.dragBox,ue)))}},cropMove:function(e){var a=this.action;if(!(this.disabled||!a)){var i=this.pointers;e.preventDefault(),ie(this.element,Be,{originalEvent:e,action:a})!==!1&&(e.changedTouches?z(e.changedTouches,function(o){_(i[o.identifier]||{},ge(o,!0))}):_(i[e.pointerId||0]||{},ge(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var a=this.action,i=this.pointers;e.changedTouches?z(e.changedTouches,function(o){delete i[o.identifier]}):delete i[e.pointerId||0],a&&(e.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,te(this.dragBox,ue,this.cropped&&this.options.modal)),ie(this.element,Me,{originalEvent:e,action:a}))}}},gi={change:function(e){var a=this.options,i=this.canvasData,o=this.containerData,r=this.cropBoxData,s=this.pointers,l=this.action,p=a.aspectRatio,c=r.left,h=r.top,d=r.width,m=r.height,y=c+d,g=h+m,E=0,b=0,k=o.width,S=o.height,D=!0,U;!p&&e.shiftKey&&(p=d&&m?d/m:1),this.limited&&(E=r.minLeft,b=r.minTop,k=E+Math.min(o.width,i.width,i.left+i.width),S=b+Math.min(o.height,i.height,i.top+i.height));var B=s[Object.keys(s)[0]],u={x:B.endX-B.startX,y:B.endY-B.startY},v=function(O){switch(O){case Y:y+u.x>k&&(u.x=k-y);break;case X:c+u.x<E&&(u.x=E-c);break;case H:h+u.y<b&&(u.y=b-h);break;case K:g+u.y>S&&(u.y=S-g);break}};switch(l){case Ne:c+=u.x,h+=u.y;break;case Y:if(u.x>=0&&(y>=k||p&&(h<=b||g>=S))){D=!1;break}v(Y),d+=u.x,d<0&&(l=X,d=-d,c-=d),p&&(m=d/p,h+=(r.height-m)/2);break;case H:if(u.y<=0&&(h<=b||p&&(c<=E||y>=k))){D=!1;break}v(H),m-=u.y,h+=u.y,m<0&&(l=K,m=-m,h-=m),p&&(d=m*p,c+=(r.width-d)/2);break;case X:if(u.x<=0&&(c<=E||p&&(h<=b||g>=S))){D=!1;break}v(X),d-=u.x,c+=u.x,d<0&&(l=Y,d=-d,c-=d),p&&(m=d/p,h+=(r.height-m)/2);break;case K:if(u.y>=0&&(g>=S||p&&(c<=E||y>=k))){D=!1;break}v(K),m+=u.y,m<0&&(l=H,m=-m,h-=m),p&&(d=m*p,c+=(r.width-d)/2);break;case ne:if(p){if(u.y<=0&&(h<=b||y>=k)){D=!1;break}v(H),m-=u.y,h+=u.y,d=m*p}else v(H),v(Y),u.x>=0?y<k?d+=u.x:u.y<=0&&h<=b&&(D=!1):d+=u.x,u.y<=0?h>b&&(m-=u.y,h+=u.y):(m-=u.y,h+=u.y);d<0&&m<0?(l=le,m=-m,d=-d,h-=m,c-=d):d<0?(l=oe,d=-d,c-=d):m<0&&(l=se,m=-m,h-=m);break;case oe:if(p){if(u.y<=0&&(h<=b||c<=E)){D=!1;break}v(H),m-=u.y,h+=u.y,d=m*p,c+=r.width-d}else v(H),v(X),u.x<=0?c>E?(d-=u.x,c+=u.x):u.y<=0&&h<=b&&(D=!1):(d-=u.x,c+=u.x),u.y<=0?h>b&&(m-=u.y,h+=u.y):(m-=u.y,h+=u.y);d<0&&m<0?(l=se,m=-m,d=-d,h-=m,c-=d):d<0?(l=ne,d=-d,c-=d):m<0&&(l=le,m=-m,h-=m);break;case le:if(p){if(u.x<=0&&(c<=E||g>=S)){D=!1;break}v(X),d-=u.x,c+=u.x,m=d/p}else v(K),v(X),u.x<=0?c>E?(d-=u.x,c+=u.x):u.y>=0&&g>=S&&(D=!1):(d-=u.x,c+=u.x),u.y>=0?g<S&&(m+=u.y):m+=u.y;d<0&&m<0?(l=ne,m=-m,d=-d,h-=m,c-=d):d<0?(l=se,d=-d,c-=d):m<0&&(l=oe,m=-m,h-=m);break;case se:if(p){if(u.x>=0&&(y>=k||g>=S)){D=!1;break}v(Y),d+=u.x,m=d/p}else v(K),v(Y),u.x>=0?y<k?d+=u.x:u.y>=0&&g>=S&&(D=!1):d+=u.x,u.y>=0?g<S&&(m+=u.y):m+=u.y;d<0&&m<0?(l=oe,m=-m,d=-d,h-=m,c-=d):d<0?(l=le,d=-d,c-=d):m<0&&(l=ne,m=-m,h-=m);break;case qe:this.move(u.x,u.y),D=!1;break;case Ge:this.zoom(ii(s),e),D=!1;break;case Xe:if(!u.x||!u.y){D=!1;break}U=ft(this.cropper),c=B.startX-U.left,h=B.startY-U.top,d=r.minWidth,m=r.minHeight,u.x>0?l=u.y>0?se:ne:u.x<0&&(c-=d,l=u.y>0?le:oe),u.y<0&&(h-=m),this.cropped||(R(this.cropBox,T),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}D&&(r.width=d,r.height=m,r.left=c,r.top=h,this.action=l,this.renderCropBox()),z(s,function(N){N.startX=N.endX,N.startY=N.endY})}},yi={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&C(this.dragBox,ue),R(this.cropBox,T),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=_({},this.initialImageData),this.canvasData=_({},this.initialCanvasData),this.cropBoxData=_({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(_(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),R(this.dragBox,ue),C(this.cropBox,T)),this},replace:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&e&&(this.isImg&&(this.element.src=e),a?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,z(this.previews,function(i){i.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,R(this.cropper,Qe)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,C(this.cropper,Qe)),this},destroy:function(){var e=this.element;return e[w]?(e[w]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,i=this.canvasData,o=i.left,r=i.top;return this.moveTo(Pe(e)?e:o+Number(e),Pe(a)?a:r+Number(a))},moveTo:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,i=this.canvasData,o=!1;return e=Number(e),a=Number(a),this.ready&&!this.disabled&&this.options.movable&&(f(e)&&(i.left=e,o=!0),f(a)&&(i.top=a,o=!0),o&&this.renderCanvas(!0)),this},zoom:function(e,a){var i=this.canvasData;return e=Number(e),e<0?e=1/(1-e):e=1+e,this.zoomTo(i.width*e/i.naturalWidth,null,a)},zoomTo:function(e,a,i){var o=this.options,r=this.canvasData,s=r.width,l=r.height,p=r.naturalWidth,c=r.naturalHeight;if(e=Number(e),e>=0&&this.ready&&!this.disabled&&o.zoomable){var h=p*e,d=c*e;if(ie(this.element,Oe,{ratio:e,oldRatio:s/p,originalEvent:i})===!1)return this;if(i){var m=this.pointers,y=ft(this.cropper),g=m&&Object.keys(m).length?ai(m):{pageX:i.pageX,pageY:i.pageY};r.left-=(h-s)*((g.pageX-y.left-r.left)/s),r.top-=(d-l)*((g.pageY-y.top-r.top)/l)}else Z(a)&&f(a.x)&&f(a.y)?(r.left-=(h-s)*((a.x-r.left)/s),r.top-=(d-l)*((a.y-r.top)/l)):(r.left-=(h-s)/2,r.top-=(d-l)/2);r.width=h,r.height=d,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return e=Number(e),f(e)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var a=this.imageData.scaleY;return this.scale(e,f(a)?a:1)},scaleY:function(e){var a=this.imageData.scaleX;return this.scale(f(a)?a:1,e)},scale:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,i=this.imageData,o=!1;return e=Number(e),a=Number(a),this.ready&&!this.disabled&&this.options.scalable&&(f(e)&&(i.scaleX=e,o=!0),f(a)&&(i.scaleY=a,o=!0),o&&this.renderCanvas(!0,!0)),this},getData:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=this.options,i=this.imageData,o=this.canvasData,r=this.cropBoxData,s;if(this.ready&&this.cropped){s={x:r.left-o.left,y:r.top-o.top,width:r.width,height:r.height};var l=i.width/i.naturalWidth;if(z(s,function(h,d){s[d]=h/l}),e){var p=Math.round(s.y+s.height),c=Math.round(s.x+s.width);s.x=Math.round(s.x),s.y=Math.round(s.y),s.width=c-s.x,s.height=p-s.y}}else s={x:0,y:0,width:0,height:0};return a.rotatable&&(s.rotate=i.rotate||0),a.scalable&&(s.scaleX=i.scaleX||1,s.scaleY=i.scaleY||1),s},setData:function(e){var a=this.options,i=this.imageData,o=this.canvasData,r={};if(this.ready&&!this.disabled&&Z(e)){var s=!1;a.rotatable&&f(e.rotate)&&e.rotate!==i.rotate&&(i.rotate=e.rotate,s=!0),a.scalable&&(f(e.scaleX)&&e.scaleX!==i.scaleX&&(i.scaleX=e.scaleX,s=!0),f(e.scaleY)&&e.scaleY!==i.scaleY&&(i.scaleY=e.scaleY,s=!0)),s&&this.renderCanvas(!0,!0);var l=i.width/i.naturalWidth;f(e.x)&&(r.left=e.x*l+o.left),f(e.y)&&(r.top=e.y*l+o.top),f(e.width)&&(r.width=e.width*l),f(e.height)&&(r.height=e.height*l),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?_({},this.containerData):{}},getImageData:function(){return this.sized?_({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,a={};return this.ready&&z(["left","top","width","height","naturalWidth","naturalHeight"],function(i){a[i]=e[i]}),a},setCanvasData:function(e){var a=this.canvasData,i=a.aspectRatio;return this.ready&&!this.disabled&&Z(e)&&(f(e.left)&&(a.left=e.left),f(e.top)&&(a.top=e.top),f(e.width)?(a.width=e.width,a.height=e.width/i):f(e.height)&&(a.height=e.height,a.width=e.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var e=this.cropBoxData,a;return this.ready&&this.cropped&&(a={left:e.left,top:e.top,width:e.width,height:e.height}),a||{}},setCropBoxData:function(e){var a=this.cropBoxData,i=this.options.aspectRatio,o,r;return this.ready&&this.cropped&&!this.disabled&&Z(e)&&(f(e.left)&&(a.left=e.left),f(e.top)&&(a.top=e.top),f(e.width)&&e.width!==a.width&&(o=!0,a.width=e.width),f(e.height)&&e.height!==a.height&&(r=!0,a.height=e.height),i&&(o?a.height=a.width/i:r&&(a.width=a.height*i)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var a=this.canvasData,i=ni(this.image,this.imageData,a,e);if(!this.cropped)return i;var o=this.getData(e.rounded),r=o.x,s=o.y,l=o.width,p=o.height,c=i.width/Math.floor(a.naturalWidth);c!==1&&(r*=c,s*=c,l*=c,p*=c);var h=l/p,d=W({aspectRatio:h,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),m=W({aspectRatio:h,width:e.minWidth||0,height:e.minHeight||0},"cover"),y=W({aspectRatio:h,width:e.width||(c!==1?i.width:l),height:e.height||(c!==1?i.height:p)}),g=y.width,E=y.height;g=Math.min(d.width,Math.max(m.width,g)),E=Math.min(d.height,Math.max(m.height,E));var b=document.createElement("canvas"),k=b.getContext("2d");b.width=ee(g),b.height=ee(E),k.fillStyle=e.fillColor||"transparent",k.fillRect(0,0,g,E);var S=e.imageSmoothingEnabled,D=S===void 0?!0:S,U=e.imageSmoothingQuality;k.imageSmoothingEnabled=D,U&&(k.imageSmoothingQuality=U);var B=i.width,u=i.height,v=r,N=s,O,L,G,Q,j,A;v<=-l||v>B?(v=0,O=0,G=0,j=0):v<=0?(G=-v,v=0,O=Math.min(B,l+v),j=O):v<=B&&(G=0,O=Math.min(l,B-v),j=O),O<=0||N<=-p||N>u?(N=0,L=0,Q=0,A=0):N<=0?(Q=-N,N=0,L=Math.min(u,p+N),A=L):N<=u&&(Q=0,L=Math.min(p,u-N),A=L);var M=[v,N,O,L];if(j>0&&A>0){var J=g/l;M.push(G*J,Q*J,j*J,A*J)}return k.drawImage.apply(k,[i].concat(je(M.map(function(ye){return Math.floor(ee(ye))})))),b},setAspectRatio:function(e){var a=this.options;return!this.disabled&&!Pe(e)&&(a.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var a=this.options,i=this.dragBox,o=this.face;if(this.ready&&!this.disabled){var r=e===Te,s=a.movable&&e===Ke;e=r||s?e:Ze,a.dragMode=e,de(i,he,e),te(i,Ce,r),te(i,Se,s),a.cropBoxMovable||(de(o,he,e),te(o,Ce,r),te(o,Se,s))}return this}},bi=V.Cropper,vt=function(){function t(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if($t(this,t),!e||!jt.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=_({},dt,Z(a)&&a),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Mt(t,[{key:"init",value:function(){var a=this.element,i=a.tagName.toLowerCase(),o;if(!a[w]){if(a[w]=this,i==="img"){if(this.isImg=!0,o=a.getAttribute("src")||"",this.originalUrl=o,!o)return;o=a.src}else i==="canvas"&&window.HTMLCanvasElement&&(o=a.toDataURL());this.load(o)}}},{key:"load",value:function(a){var i=this;if(a){this.url=a,this.imageData={};var o=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Ft.test(a)){Wt.test(a)?this.read(li(a)):this.clone();return}var s=new XMLHttpRequest,l=this.clone.bind(this);this.reloading=!0,this.xhr=s,s.onabort=l,s.onerror=l,s.ontimeout=l,s.onprogress=function(){s.getResponseHeader("content-type")!==st&&s.abort()},s.onload=function(){i.read(s.response)},s.onloadend=function(){i.reloading=!1,i.xhr=null},r.checkCrossOrigin&&gt(a)&&o.crossOrigin&&(a=yt(a)),s.open("GET",a,!0),s.responseType="arraybuffer",s.withCredentials=o.crossOrigin==="use-credentials",s.send()}}},{key:"read",value:function(a){var i=this.options,o=this.imageData,r=di(a),s=0,l=1,p=1;if(r>1){this.url=hi(a,st);var c=ci(r);s=c.rotate,l=c.scaleX,p=c.scaleY}i.rotatable&&(o.rotate=s),i.scalable&&(o.scaleX=l,o.scaleY=p),this.clone()}},{key:"clone",value:function(){var a=this.element,i=this.url,o=a.crossOrigin,r=i;this.options.checkCrossOrigin&&gt(i)&&(o||(o="anonymous"),r=yt(i)),this.crossOrigin=o,this.crossOriginUrl=r;var s=document.createElement("img");o&&(s.crossOrigin=o),s.src=r||i,s.alt=a.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),C(s,Je),a.parentNode.insertBefore(s,a.nextSibling)}},{key:"start",value:function(){var a=this,i=this.image;i.onload=null,i.onerror=null,this.sizing=!0;var o=V.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(V.navigator.userAgent),r=function(c,h){_(a.imageData,{naturalWidth:c,naturalHeight:h,aspectRatio:c/h}),a.initialImageData=_({},a.imageData),a.sizing=!1,a.sized=!0,a.build()};if(i.naturalWidth&&!o){r(i.naturalWidth,i.naturalHeight);return}var s=document.createElement("img"),l=document.body||document.documentElement;this.sizingImage=s,s.onload=function(){r(s.width,s.height),o||l.removeChild(s)},s.src=i.src,o||(s.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",l.appendChild(s))}},{key:"stop",value:function(){var a=this.image;a.onload=null,a.onerror=null,a.parentNode.removeChild(a),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var a=this.element,i=this.options,o=this.image,r=a.parentNode,s=document.createElement("div");s.innerHTML=Yt;var l=s.querySelector(".".concat(w,"-container")),p=l.querySelector(".".concat(w,"-canvas")),c=l.querySelector(".".concat(w,"-drag-box")),h=l.querySelector(".".concat(w,"-crop-box")),d=h.querySelector(".".concat(w,"-face"));this.container=r,this.cropper=l,this.canvas=p,this.dragBox=c,this.cropBox=h,this.viewBox=l.querySelector(".".concat(w,"-view-box")),this.face=d,p.appendChild(o),C(a,T),r.insertBefore(l,a.nextSibling),R(o,Je),this.initPreview(),this.bind(),i.initialAspectRatio=Math.max(0,i.initialAspectRatio)||NaN,i.aspectRatio=Math.max(0,i.aspectRatio)||NaN,i.viewMode=Math.max(0,Math.min(3,Math.round(i.viewMode)))||0,C(h,T),i.guides||C(h.getElementsByClassName("".concat(w,"-dashed")),T),i.center||C(h.getElementsByClassName("".concat(w,"-center")),T),i.background&&C(l,"".concat(w,"-bg")),i.highlight||C(d,At),i.cropBoxMovable&&(C(d,Se),de(d,he,Ne)),i.cropBoxResizable||(C(h.getElementsByClassName("".concat(w,"-line")),T),C(h.getElementsByClassName("".concat(w,"-point")),T)),this.render(),this.ready=!0,this.setDragMode(i.dragMode),i.autoCrop&&this.crop(),this.setData(i.data),$(i.ready)&&x(a,rt,i.ready,{once:!0}),ie(a,rt)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var a=this.cropper.parentNode;a&&a.removeChild(this.cropper),R(this.element,T)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=bi,t}},{key:"setDefaults",value:function(a){_(dt,Z(a)&&a)}}]),t}();_(vt.prototype,pi,mi,ui,fi,gi,yi);const hr="",vi=n.defineComponent({name:"UploadEntry",props:{file:{type:File,required:!0},baseUrl:{type:String,required:!0},maxSize:{type:Number,default:0},mimetypes:{type:Array,default:()=>[]},automatic:{type:Boolean,default:!0},withCropping:{type:Boolean,default:!1},croppingOptions:{type:Object,default:()=>({})}},emits:{setToken(t){return t.length>0},delete(){return!0}},data(){return{uploadFile:null,progress:0,token:"",error:"",isCropped:!1,cropper:null}},computed:{showCropper(){return this.withCropping&&this.isImage&&!this.isCropped},isImage:function(){return this.file.type.split("/")[0]==="image"},altThumbnail:function(){const t=this.file.name.split(".");return t.length>1?t[t.length-1]:this.file.type.split("/")[1]},fileUrl:function(){return this.uploadFile?URL.createObjectURL(this.uploadFile):""},humanizedSize:function(){return ve(this.file.size)}},mounted(){this.uploadFile=this.file,this.maxSize&&this.file.size>this.maxSize?this.error=this.$t("upload_entry.too_large"):this.mimetypes.length&&!this.mimetypes.includes(this.file.type)?this.error=this.$tc("upload_entry.wrong_type",this.mimetypes.length,{types:this.mimetypes.join(", ")}):this.automatic&&!this.withCropping?this.sendFile():this.withCropping||Ie.on("upload",this.sendFile)},methods:{crop(){if(this.cropper===null){console.error("cropper is null.");return}this.cropper.getCroppedCanvas().toBlob(t=>{if(t===null){console.error("blob is null.");return}this.uploadFile=new File([t],this.file.name,{type:this.file.type}),jQuery(this.$refs.cropperModal).modal("hide"),this.isCropped=!0,this.automatic&&this.sendFile()})},initializeCropper(){this.cropper=new vt(this.$refs.image,{minContainerWidth:600,minContainerHeight:300,viewMode:2,autoCropArea:1,movable:!1,rotatable:!1,scalable:!1,zoomable:!1,toggleDragModeOnDblclick:!1,...this.croppingOptions}),jQuery(this.$refs.cropperModal).modal("show")},revokeUrl:function(t){URL.revokeObjectURL(t)},sendFile:function(){if(this.uploadFile===null){console.error("uploadFile is null.");return}const t=new XMLHttpRequest;t.upload.addEventListener("progress",a=>{this.progress=Math.round(a.loaded*100/a.total)},!1),t.open("POST",`${this.baseUrl}request-upload`,!0),t.addEventListener("readystatechange",()=>{if(t.readyState===4&&t.status>=200&&t.status<=300){const a=JSON.parse(t.responseText);this.$emit("setToken",a.token)}else{let a;try{a=JSON.parse(t.responseText).detail}catch{a=t.statusText}this.error=this.$t("request_error",{error:a})}});const e=new FormData;e.append("file",this.uploadFile),t.send(e)}}}),dr="",pe=(t,e)=>{const a=t.__vccOpts||t;for(const[i,o]of e)a[i]=o;return a},wi={class:"media"},_i={class:"media-left"},Ei=["src","alt"],zi={key:1,class:"img-thumbnail text-thumbnail"},Di={class:"media-body"},ki={class:"media-heading"},Ni={class:"text-nowrap"},Ci={key:0,class:"progress"},Si=["aria-valuenow"],Ti={class:"sr-only"},$i={key:1,class:"text-danger"},Mi={class:"media-right"},Bi=[n.createElementVNode("span",{class:"fas fa-trash-alt"},null,-1)],xi={key:0,ref:"cropperModal",class:"modal fade",tabindex:"-1",role:"dialog","data-backdrop":"static"},Oi={class:"modal-dialog modal-lg",role:"document"},Pi={class:"modal-content"},Vi={class:"modal-header"},Ri={class:"modal-title"},Ai={class:"modal-body"},Ui=["src","alt"],Li={class:"modal-footer"};function Ii(t,e,a,i,o,r){return n.openBlock(),n.createElementBlock(n.Fragment,null,[n.createElementVNode("li",wi,[n.createElementVNode("div",_i,[t.isImage&&t.uploadFile&&(!t.withCropping||t.isCropped)?(n.openBlock(),n.createElementBlock("img",{key:0,class:"media-object img-thumbnail",src:t.fileUrl,alt:t.uploadFile.name,width:"80",onLoad:e[0]||(e[0]=s=>t.revokeUrl(t.fileUrl))},null,40,Ei)):(n.openBlock(),n.createElementBlock("div",zi,n.toDisplayString(t.altThumbnail),1))]),n.createElementVNode("div",Di,[n.createElementVNode("h4",ki,[n.createTextVNode(n.toDisplayString(t.file.name)+" ",1),n.createElementVNode("small",null,[n.createElementVNode("span",Ni,n.toDisplayString(t.humanizedSize),1),n.createTextVNode(" ("+n.toDisplayString(t.file.type)+")",1)])]),t.error?(n.openBlock(),n.createElementBlock("span",$i,n.toDisplayString(t.error),1)):(n.openBlock(),n.createElementBlock("div",Ci,[n.createElementVNode("div",{class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":t.progress,"aria-valuemin":"0","aria-valuemax":"100",style:n.normalizeStyle({width:`${t.progress}%`})},[n.createElementVNode("span",Ti,n.toDisplayString(t.$t("upload_entry.completion",{progress:t.progress})),1)],12,Si)]))]),n.createElementVNode("div",Mi,[n.createElementVNode("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=s=>t.$emit("delete"))},Bi)])]),t.showCropper?(n.openBlock(),n.createElementBlock("div",xi,[n.createElementVNode("div",Oi,[n.createElementVNode("div",Pi,[n.createElementVNode("div",Vi,[n.createElementVNode("h4",Ri,n.toDisplayString(t.$t("upload_entry.crop_header")),1)]),n.createElementVNode("div",Ai,[n.createElementVNode("img",{ref:"image",src:t.fileUrl,alt:t.file.name,onLoad:e[2]||(e[2]=(...s)=>t.initializeCropper&&t.initializeCropper(...s))},null,40,Ui)]),n.createElementVNode("div",Li,[n.createElementVNode("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=(...s)=>t.crop&&t.crop(...s))},n.toDisplayString(t.$t("upload_entry.crop")),1),n.createElementVNode("button",{type:"button",class:"btn btn-danger","data-dismiss":"modal",onClick:e[4]||(e[4]=s=>t.$emit("delete"))},n.toDisplayString(t.$t("upload_entry.cancel")),1)])])])],512)):n.createCommentVNode("",!0)],64)}const Hi=pe(vi,[["render",Ii]]),Fi=n.defineComponent({name:"ViewingModal",props:{baseUrl:{type:String,required:!0},value:{type:String,required:!0},id:{type:String,required:!0},file:{type:Object,required:!0},isEditable:{type:Boolean,default:!0},openOnMount:{type:Boolean,default:!1}},emits:{updateToken(t){return t.length>0}},data:function(){return{rotation:0,originalHeight:null,originalWidth:null,modalHeight:"auto",modalWidth:"auto",error:"",saved:!1}},computed:{isImage:function(){return this.file.mimetype.split("/")[0]==="image"},imageStyle:function(){let t=`rotate(${this.rotation}deg)`;this.isQuarterRotated?t+=` translate(${this.isRotated90CounterClockwise?"-50%":"50%"}, -50%)`:this.isRotated&&(t+=" translate(0, -100%)");const e=this.$refs.modal,a=this.originalHeight&&this.isQuarterRotated&&e.clientWidth<this.originalHeight?`${e.clientWidth-30}px`:"auto";return{transform:t,height:a}},isRotated:function(){return this.rotation%360},isQuarterRotated:function(){return this.rotation%180},isRotated90CounterClockwise:function(){return[-90,270].includes(this.rotation%360)}},watch:{rotation:"changeModalHeight"},mounted(){jQuery(this.$el).on("shown.bs.modal",()=>{this.originalHeight||this.imageLoaded(this.$refs.img),this.changeModalHeight()}),this.openOnMount&&jQuery(this.$el).modal("show")},beforeUnmount(){jQuery(this.$el).modal("hide")},methods:{imageLoaded:async function(t){await n.nextTick(),this.originalHeight=t.clientHeight,this.originalWidth=t.clientWidth,this.changeModalHeight()},changeModalHeight:function(){if(!this.originalWidth||!this.originalHeight)return"auto";const t=this.$refs.modal;this.isQuarterRotated&&t.clientWidth<this.originalHeight?this.modalHeight=`${t.clientWidth*this.originalWidth/this.originalHeight+30}px`:this.modalHeight=`${(this.isQuarterRotated?this.originalWidth:this.originalHeight)+30}px`},saveRotation:async function(){try{const t=await re(`${this.baseUrl}rotate-image/${this.value}`,{method:"POST",body:JSON.stringify({rotate:this.rotation})});this.saved=!0,this.rotation=0,this.$emit("updateToken",t.token),this.error=""}catch(t){this.error=t.message}}}}),Wi=["id"],ji={class:"modal-dialog modal-lg",role:"document"},Yi={class:"modal-content"},Xi={class:"modal-header"},qi=["aria-label"],Gi=[n.createElementVNode("span",{"aria-hidden":"true"},"×",-1)],Qi={class:"modal-title"},Ji=["src","alt"],Ki={key:1,class:"embed-responsive embed-responsive-16by9"},Zi=["data"],ea=["src"],ta={class:"modal-footer"},ia={class:"row"},aa={key:0,class:"col-sm-10 text-left"},ra=[n.createElementVNode("i",{class:"fas fa-undo"},null,-1)],na=[n.createElementVNode("i",{class:"fas fa-redo"},null,-1)],oa=["disabled"],sa={key:0,class:"text-danger"},la={class:"col-sm-2 pull-right"},ha={type:"button",class:"btn btn-default","data-dismiss":"modal"};function da(t,e,a,i,o,r){return n.openBlock(),n.createElementBlock("div",{id:`modal-${t.id}`,class:"modal fade",tabindex:"-1",role:"dialog"},[n.createElementVNode("div",ji,[n.createElementVNode("div",Yi,[n.createElementVNode("div",Xi,[n.createElementVNode("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":t.$t("view_entry.close")},Gi,8,qi),n.createElementVNode("h4",Qi,n.toDisplayString(t.file.name),1)]),n.createElementVNode("div",{ref:"modal",class:"modal-body",style:n.normalizeStyle([{transition:"500ms",overflow:"hidden","max-width":"100%"},{height:t.modalHeight}])},[t.isImage?(n.openBlock(),n.createElementBlock("img",{key:0,ref:"img",src:t.file.url,alt:t.file.name,class:"img-responsive",style:n.normalizeStyle([{transition:"500ms","transform-origin":"top center",margin:"0 auto"},t.imageStyle]),onLoad:e[0]||(e[0]=s=>t.imageLoaded(s.target))},null,44,Ji)):(n.openBlock(),n.createElementBlock("div",Ki,[n.createElementVNode("object",{data:t.file.url,type:"application/pdf",class:"embed-responsive-item"},[n.createElementVNode("embed",{src:t.file.url,type:"application/pdf"},null,8,ea)],8,Zi)]))],4),n.createElementVNode("div",ta,[n.createElementVNode("div",ia,[t.isImage&&t.isEditable?(n.openBlock(),n.createElementBlock("div",aa,[n.createElementVNode("button",{type:"button",class:"btn btn-default",onClick:e[1]||(e[1]=s=>t.rotation-=90)},ra),n.createElementVNode("button",{type:"button",class:"btn btn-default",onClick:e[2]||(e[2]=s=>t.rotation+=90)},na),n.createElementVNode("button",{type:"button",class:"btn btn-default",disabled:!t.isRotated,onClick:e[3]||(e[3]=(...s)=>t.saveRotation&&t.saveRotation(...s))},[n.createElementVNode("i",{class:n.normalizeClass(`fas fa-${t.saved?"check":"save"}`)},null,2),n.createTextVNode(" "+n.toDisplayString(t.$t("view_entry.save")),1)],8,oa),t.error?(n.openBlock(),n.createElementBlock("span",sa,n.toDisplayString(t.$t("error",{error:t.error})),1)):n.createCommentVNode("",!0)])):n.createCommentVNode("",!0),n.createElementVNode("div",la,[n.createElementVNode("button",ha,n.toDisplayString(t.$t("view_entry.close")),1)])])])])])],8,Wi)}const ca=pe(Fi,[["render",da]]),pa=n.defineComponent({name:"ViewEntry",components:{ViewingModal:ca},props:{value:{type:String,required:!0},id:{type:String,required:!0},baseUrl:{type:String,required:!0},isEditable:{type:Boolean,default:!0},editableFilename:{type:Boolean,default:!0},getProgressUrl:{type:String,default:""},postProcessStatus:{type:String,default:""},baseUuid:{type:String,default:""},wantedPostProcess:{type:String,default:""}},emits:{updateToken(t){return t.length>0},delete(){return!0}},data(){return{file:null,loading:!0,inPostProcessing:!1,postProcessingProgress:0,error:"",name:"",extension:"",saved:!1,intervalProgress:setInterval(()=>{},3e5),getRemoteTokenResponse:{token:""}}},computed:{isImage:function(){var t;return((t=this.file)==null?void 0:t.mimetype.split("/")[0])==="image"},altThumbnail:function(){if(this.file){const t=this.file.name.split(".");return t.length>1?t[t.length-1]:this.file.mimetype.split("/")[1]}},isViewableDocument:function(){const t=this.file.mimetype;return t.split("/")[0]==="image"||t==="application/pdf"},formattedValue:function(){return this.value.replace(/:/g,"-")},fullName:{get(){return`${this.name}${this.extension}`},set:function(t){const e=/^(.+)(\.[^.]+)$/.exec(t);(e==null?void 0:e.length)===3?(this.name=e[1],this.extension=e[2]):(this.name=t,this.extension="")}}},watch:{value:"getFile"},mounted(){this.getFile()},updated(){this.inPostProcessing&&((this.getProgressUrl!==""||this.getProgressUrl!==void 0)&&this.postProcessingProgress!==100&&(clearInterval(this.intervalProgress),this.intervalProgress=setInterval(()=>{this.getProgressPostProcessing()},3e3)),this.postProcessingProgress===100&&(clearInterval(this.intervalProgress),this.inPostProcessing=!1,this.getFile()))},unmounted(){clearInterval(this.intervalProgress)},methods:{humanizedSize:ve,getFile:async function(){if(this.value==="FileInfectedException")this.error=this.$t("view_entry.file_infected");else if(this.value===""&&this.postProcessingProgress!==100)this.inPostProcessing=!0,await this.getProgressPostProcessing();else{if(this.value===""){let e=JSON.stringify({uuid:this.baseUuid});(this.wantedPostProcess===""||this.wantedPostProcess===void 0)&&(e=JSON.stringify({uuid:this.baseUuid,wanted_post_process:this.wantedPostProcess})),this.getRemoteTokenResponse=await re(`${this.baseUrl}read-token/${this.baseUuid}`,{method:"POST",body:e})}const t=this.getRemoteTokenResponse.token!==""?`${this.baseUrl}metadata/${this.getRemoteTokenResponse.token}`:`${this.baseUrl}metadata/${this.value}`;try{this.file=await re(t),this.fullName=this.file.name}catch(e){this.error=e.message}}this.loading=!1,console.log("loading est false")},getProgressPostProcessing:async function(){/* istanbul ignore if -- @preserve */if(this.postProcessingProgress!==100&&this.getProgressUrl!=="")try{let t="";this.wantedPostProcess?t=this.getProgressUrl+"?wanted_post_process="+this.wantedPostProcess:t=this.getProgressUrl;const e=await re(`${t}`,{method:"GET"});this.postProcessingProgress=e.progress}catch(t){this.error=t.message}},saveName:async function(){try{await re(`${this.baseUrl}change-metadata/${this.value}`,{method:"POST",body:JSON.stringify({name:this.fullName})}),this.saved=!0,this.file.name=this.fullName}catch(t){this.error=t.message}}}}),fr="",ma={class:"media"},ua={key:0,class:"media-body"},fa={class:"progress"},ga={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},ya={class:"sr-only"},ba={key:1,class:"media-body"},va={class:"progress",style:{"text-align":"center"}},wa={class:"sr-only"},_a={class:"align-items-center"},Ea={class:"media-body"},za={class:"text-danger"},Da={class:"media-right text-right"},ka=[n.createElementVNode("span",{class:"fas fa-trash-alt"},null,-1)],Na={class:"media-left"},Ca=["src","alt"],Sa={key:1,class:"img-thumbnail text-thumbnail"},Ta={class:"media-body"},$a={class:"media-heading"},Ma={key:0,class:"input-group"},Ba={key:0,class:"input-group-addon"},xa={class:"input-group-btn"},Oa=["disabled"],Pa={key:1},Va={class:"text-nowrap"},Ra={class:"btn-group"},Aa=["data-target"],Ua=[n.createElementVNode("span",{class:"fas fa-eye"},null,-1)],La=["href"],Ia=[n.createElementVNode("span",{class:"fas fa-download"},null,-1)],Ha=[n.createElementVNode("span",{class:"fas fa-trash-alt"},null,-1)];function Fa(t,e,a,i,o,r){const s=n.resolveComponent("ViewingModal");return n.openBlock(),n.createElementBlock("li",ma,[t.loading?(n.openBlock(),n.createElementBlock("div",ua,[n.createElementVNode("div",fa,[n.createElementVNode("div",ga,[n.createElementVNode("span",ya,n.toDisplayString(t.$t("view_entry.loading")),1)])])])):t.inPostProcessing?(n.openBlock(),n.createElementBlock("div",ba,[n.createElementVNode("div",va,[n.createElementVNode("div",{class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:n.normalizeStyle({width:t.postProcessingProgress.toString()+"%"})},[n.createElementVNode("span",wa,n.toDisplayString(t.$t("view_entry.loading")),1)],4),n.createElementVNode("span",_a,"Avancement du post processing : "+n.toDisplayString(t.postProcessingProgress)+" %",1)])])):t.error?(n.openBlock(),n.createElementBlock(n.Fragment,{key:2},[n.createElementVNode("div",Ea,[n.createElementVNode("span",za,n.toDisplayString(t.$t("error",{error:t.error})),1)]),n.createElementVNode("div",Da,[t.isEditable?(n.openBlock(),n.createElementBlock("button",{key:0,class:"btn btn-danger",type:"button",onClick:e[0]||(e[0]=l=>t.$emit("delete"))},ka)):n.createCommentVNode("",!0)])],64)):t.file?(n.openBlock(),n.createElementBlock(n.Fragment,{key:3},[n.createElementVNode("div",Na,[t.isImage?(n.openBlock(),n.createElementBlock("img",{key:0,class:"media-object img-thumbnail",src:t.file.url,alt:t.file.name,width:"80"},null,8,Ca)):(n.openBlock(),n.createElementBlock("div",Sa,n.toDisplayString(t.altThumbnail),1))]),n.createElementVNode("div",Ta,[n.createElementVNode("h4",$a,[t.isEditable&&t.editableFilename?(n.openBlock(),n.createElementBlock("div",Ma,[n.withDirectives(n.createElementVNode("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.name=l),type:"text",class:"form-control",onInput:e[2]||(e[2]=l=>t.saved=!1)},null,544),[[n.vModelText,t.name]]),t.extension?(n.openBlock(),n.createElementBlock("span",Ba,n.toDisplayString(t.extension),1)):n.createCommentVNode("",!0),n.createElementVNode("span",xa,[n.createElementVNode("button",{type:"button",disabled:t.file.name===t.fullName,class:"btn btn-default",onClick:e[3]||(e[3]=(...l)=>t.saveName&&t.saveName(...l))},[n.createElementVNode("i",{class:n.normalizeClass(`fas fa-${t.saved?"check":"save"}`)},null,2)],8,Oa)])])):(n.openBlock(),n.createElementBlock("div",Pa,n.toDisplayString(t.file.name),1)),n.createElementVNode("small",null,[n.createElementVNode("span",Va,n.toDisplayString(t.humanizedSize(t.file.size)),1),n.createTextVNode(" ("+n.toDisplayString(t.file.mimetype)+")",1)])])]),n.createElementVNode("div",{class:"media-right text-right",style:n.normalizeStyle({"min-width":t.isViewableDocument?"9.5em":"7em"})},[n.createElementVNode("div",Ra,[t.isViewableDocument?(n.openBlock(),n.createElementBlock("a",{key:0,class:"btn btn-default","data-toggle":"modal","data-target":`#modal-${t.formattedValue}`},Ua,8,Aa)):n.createCommentVNode("",!0),n.createElementVNode("a",{class:"btn btn-default",target:"_blank",href:`${t.file.url}?dl=1`},Ia,8,La),t.isEditable?(n.openBlock(),n.createElementBlock("button",{key:1,class:"btn btn-danger",type:"button",onClick:e[4]||(e[4]=l=>t.$emit("delete"))},Ha)):n.createCommentVNode("",!0)])],4),t.isViewableDocument?(n.openBlock(),n.createBlock(s,{key:0,id:t.formattedValue,file:t.file,"is-editable":t.isEditable,value:t.value,"base-url":t.baseUrl,onUpdateToken:e[5]||(e[5]=l=>t.$emit("updateToken",l))},null,8,["id","file","is-editable","value","base-url"])):n.createCommentVNode("",!0)],64)):n.createCommentVNode("",!0)])}const wt=pe(pa,[["render",Fa]]),Wa="osisdocument:",ja="add",Ya="delete",Xa=n.defineComponent({name:"DocumentUploader",components:{UploadEntry:Hi,ViewEntry:wt},props:{name:{type:String,required:!0},baseUrl:{type:String,required:!0},uploadText:{type:String,default:null},uploadButtonText:{type:String,default:null},maxSize:{type:Number,default:0},automaticUpload:{type:Boolean,default:!0},editableFilename:{type:Boolean,default:!0},values:{type:Array,default:()=>[]},mimetypes:{type:Array,default:()=>[]},minFiles:{type:Number,default:0},maxFiles:{type:Number,default:0},withCropping:{type:Boolean,default:!1},croppingOptions:{type:Object,default:()=>({})}},data(){let t=0;return{isDragging:!1,fileList:{},tokens:Object.fromEntries(this.values.map(e=>(t++,[t,e]))),indexGenerated:t}},computed:{filteredTokens:function(){return Object.fromEntries(Object.entries(this.tokens).filter(t=>!!t[1]))},cleanedTokens:function(){return Object.fromEntries(Object.entries(this.tokens).filter(t=>!!t[1]&&!["FileInfectedException","UploadInvalidException"].includes(t[1])))},nbUploadedFiles:function(){return Object.values(this.cleanedTokens).length},dragNDropLabel:function(){return this.minFiles?this.minFiles===this.maxFiles?this.$tc("uploader.specific_nb_drag_n_drop_label",this.minFiles):this.maxFiles?this.$t("uploader.min_max_drag_n_drop_label",{min:this.minFiles,max:this.maxFiles}):this.$tc("uploader.min_drag_n_drop_label",this.minFiles):this.maxFiles?this.$tc("uploader.max_drag_n_drop_label",this.maxFiles):this.$t("uploader.drag_n_drop_label")}},watch:{cleanedTokens:{handler(t,e){if(JSON.stringify(e)!==JSON.stringify(t)){const a=Object.keys(e).length>Object.keys(t).length?Ya:ja,i=new CustomEvent(Wa+a,{bubbles:!0,detail:{newTokens:t,oldTokens:e}});this.$el.dispatchEvent(i)}}}},mounted(){jQuery("> input",this.$el).on("change",t=>{jQuery(t.target).val()||(this.tokens={})})},methods:{humanizedSize:ve,triggerUpload(){Ie.emit("upload")},onFilePicked(t){const e=t.target.files;this.isDragging=!1,e&&Array.from(e).forEach(a=>{this.indexGenerated++,this.fileList[this.indexGenerated]=a,this.tokens[this.indexGenerated]=null})}}}),wr="",qa=["accept"],Ga=n.createElementVNode("span",{class:"glyphicon glyphicon-plus"},null,-1),Qa={key:0},Ja={key:1,class:"media-list"},Ka={key:2,class:"text-right form-group"},Za={class:"media-list"},er=["name","value"];function tr(t,e,a,i,o,r){const s=n.resolveComponent("UploadEntry"),l=n.resolveComponent("ViewEntry");return n.openBlock(),n.createElementBlock(n.Fragment,null,[t.maxFiles===0||t.nbUploadedFiles<t.maxFiles?(n.openBlock(),n.createElementBlock("div",{key:0,class:n.normalizeClass(["dropzone form-group",{hovering:t.isDragging}]),onDragenter:e[3]||(e[3]=p=>t.isDragging=!0)},[n.createElementVNode("input",{ref:"fileInput",type:"file",multiple:"",accept:t.mimetypes.length?t.mimetypes.join(","):void 0,onDragleave:e[0]||(e[0]=p=>t.isDragging=!1),onChange:e[1]||(e[1]=(...p)=>t.onFilePicked&&t.onFilePicked(...p))},null,40,qa),n.createTextVNode(" "+n.toDisplayString(t.uploadText||t.dragNDropLabel)+" ",1),n.createElementVNode("button",{class:"btn btn-default",type:"button",onClick:e[2]||(e[2]=p=>t.$refs.fileInput.click())},[Ga,n.createTextVNode(" "+n.toDisplayString(t.uploadButtonText||t.$t("uploader.add_file_label")),1)]),t.maxSize?(n.openBlock(),n.createElementBlock("span",Qa,n.toDisplayString(t.$t("uploader.max_size_label",{size:t.humanizedSize(t.maxSize)})),1)):n.createCommentVNode("",!0)],34)):n.createCommentVNode("",!0),t.fileList?(n.openBlock(),n.createElementBlock("ul",Ja,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(t.fileList,(p,c)=>(n.openBlock(),n.createBlock(s,{key:c,file:p,"base-url":t.baseUrl,"max-size":t.maxSize,mimetypes:t.mimetypes,automatic:t.automaticUpload,"with-cropping":t.withCropping,"cropping-options":t.croppingOptions,onDelete:h=>{delete t.fileList[c],delete t.tokens[c]},onSetToken:h=>{t.tokens[c]=h,delete t.fileList[c]}},null,8,["file","base-url","max-size","mimetypes","automatic","with-cropping","cropping-options","onDelete","onSetToken"]))),128))])):n.createCommentVNode("",!0),!t.automaticUpload&&Object.values(t.fileList).length?(n.openBlock(),n.createElementBlock("div",Ka,[n.createElementVNode("button",{class:"btn btn-default",type:"button",onClick:e[4]||(e[4]=(...p)=>t.triggerUpload&&t.triggerUpload(...p))},n.toDisplayString(t.$t("uploader.trigger_upload")),1)])):n.createCommentVNode("",!0),n.createElementVNode("ul",Za,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(t.filteredTokens,(p,c)=>(n.openBlock(),n.createBlock(l,{id:`${t.name}-${c}`,key:c,value:p,"base-url":t.baseUrl,editable:!0,"editable-filename":t.editableFilename,onDelete:h=>delete t.tokens[c],onUpdateToken:h=>t.tokens[c]=h},null,8,["id","value","base-url","editable-filename","onDelete","onUpdateToken"]))),128))]),(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(Object.values(t.cleanedTokens),(p,c)=>(n.openBlock(),n.createElementBlock("input",{key:`${t.name}_${c}`,type:"hidden",name:`${t.name}_${c}`,value:p},null,8,er))),128))],64)}const ir=pe(Xa,[["render",tr]]),ar=n.defineComponent({name:"DocumentVisualizer",components:{ViewEntry:wt},props:{baseUrl:{type:String,required:!0},values:{type:Array,required:!0},postProcessStatus:{type:String,required:!0},getProgressUrl:{type:String,required:!0},baseUuid:{type:String,required:!0},wantedPostProcess:{type:String,required:!0}}}),rr={class:"media-list"};function nr(t,e,a,i,o,r){const s=n.resolveComponent("ViewEntry");return n.openBlock(),n.createElementBlock("ul",rr,[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(t.values,(l,p)=>(n.openBlock(),n.createBlock(s,{id:p.toString(),key:p,value:l,"base-url":t.baseUrl,"is-editable":!1,"get-progress-url":t.getProgressUrl,"post-process-status":t.postProcessStatus,"base-uuid":t.baseUuid,"wanted-post-process":t.wantedPostProcess},null,8,["id","value","base-url","get-progress-url","post-process-status","base-uuid","wanted-post-process"]))),128))])}const or=pe(ar,[["render",nr]]);function _t(){document.querySelectorAll(".osis-document-uploader:not([data-v-app])").forEach(t=>{const e={baseUrl:"",...t.dataset};typeof t.dataset.maxSize<"u"&&(e.maxSize=Number.parseInt(t.dataset.maxSize)),typeof t.dataset.minFiles<"u"&&(e.minFiles=Number.parseInt(t.dataset.minFiles)),typeof t.dataset.maxFiles<"u"&&(e.maxFiles=Number.parseInt(t.dataset.maxFiles)),typeof t.dataset.mimetypes<"u"&&(e.mimetypes=t.dataset.mimetypes.split(",")),typeof t.dataset.values<"u"&&(e.values=t.dataset.values.split(",")),typeof t.dataset.automaticUpload<"u"&&(e.automaticUpload=t.dataset.automaticUpload==="true"),typeof t.dataset.editableFilename<"u"&&(e.editableFilename=t.dataset.editableFilename==="true"),typeof t.dataset.withCropping<"u"&&(e.withCropping=t.dataset.withCropping==="true"),typeof t.dataset.croppingOptions<"u"&&(e.croppingOptions=JSON.parse(t.dataset.croppingOptions)),I.createApp(ir,e).use(be).mount(t)}),document.querySelectorAll(".osis-document-visualizer:not([data-v-app])").forEach(t=>{const e={baseUrl:"",values:[],postProcessStatus:"",getProgressUrl:"",baseUuid:"",wantedPostProcess:"",...t.dataset};typeof t.dataset.values<"u"&&(e.values=t.dataset.values.split(",")),typeof t.dataset.postProcessStatus<"u"&&(e.postProcessStatus=t.dataset.postProcessStatus),typeof t.dataset.getProgressUrl<"u"&&(e.getProgressUrl=t.dataset.getProgressUrl),typeof t.dataset.baseUuid<"u"&&(e.baseUuid=t.dataset.baseUuid),typeof t.dataset.wantedPostProcess<"u"&&(e.wantedPostProcess=t.dataset.wantedPostProcess),I.createApp(or,e).use(be).mount(t)})}_t(),new MutationObserver(_t).observe(document,{childList:!0,subtree:!0})});
//# sourceMappingURL=osis-document.umd.min.js.map
