{"version":3,"file":"ViewEntry-61975da8.js","sources":["../../frontend/components/ViewEntry.vue"],"sourcesContent":["<!--\n  -\n  -   OSIS stands for Open Student Information System. It's an application\n  -   designed to manage the core business of higher education institutions,\n  -   such as universities, faculties, institutes and professional schools.\n  -   The core business involves the administration of students, teachers,\n  -   courses, programs and so on.\n  -\n  -   Copyright (C) 2015-2021 UniversitÃ© catholique de Louvain (http://www.uclouvain.be)\n  -\n  -   This program is free software: you can redistribute it and/or modify\n  -   it under the terms of the GNU General Public License as published by\n  -   the Free Software Foundation, either version 3 of the License, or\n  -   (at your option) any later version.\n  -\n  -   This program is distributed in the hope that it will be useful,\n  -   but WITHOUT ANY WARRANTY; without even the implied warranty of\n  -   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  -   GNU General Public License for more details.\n  -\n  -   A copy of this license - GNU General Public License - is available\n  -   at the root of the source code of this program.  If not,\n  -   see http://www.gnu.org/licenses/.\n  -\n  -->\n\n<template>\n  <li class=\"media\">\n    <!-- progress bar -->\n    <div\n        v-if=\"loading\"\n        class=\"media-body\"\n    >\n      <div class=\"progress\">\n        <div\n            class=\"progress-bar progress-bar-striped active\"\n            role=\"progressbar\"\n            aria-valuenow=\"0\"\n            aria-valuemin=\"0\"\n            aria-valuemax=\"100\"\n            :style=\"{width: `100%`}\"\n        >\n          <span class=\"sr-only\">{{ $t('view_entry.loading') }}</span>\n        </div>\n      </div>\n    </div>\n    <!-- error -->\n    <template v-else-if=\"error\">\n      <div class=\"media-body\">\n        <span class=\"text-danger\">{{ $t('error', { error }) }}</span>\n      </div>\n      <div class=\"media-right text-right\">\n        <button\n            v-if=\"isEditable\"\n            class=\"btn btn-danger\"\n            type=\"button\"\n            @click=\"$emit('delete')\"\n        >\n          <span class=\"fas fa-trash-alt\" />\n        </button>\n      </div>\n    </template>\n    <!-- thumbnail -->\n    <template v-else-if=\"file\">\n      <div\n          v-if=\"isImage\"\n          class=\"media-left\"\n      >\n        <img\n            class=\"media-object img-thumbnail\"\n            :src=\"file.url\"\n            :alt=\"file.name\"\n            width=\"80\"\n        >\n      </div>\n      <div class=\"media-body\">\n        <h4 class=\"media-heading\">\n          <div\n              v-if=\"isEditable && editableFilename\"\n              class=\"input-group\"\n          >\n            <input\n                v-model=\"name\"\n                type=\"text\"\n                class=\"form-control\"\n                @input=\"saved = false\"\n            >\n            <span\n                v-if=\"extension\"\n                class=\"input-group-addon\"\n            >\n              {{ extension }}\n            </span>\n            <span class=\"input-group-btn\">\n              <button\n                  type=\"button\"\n                  :disabled=\"file.name === fullName\"\n                  class=\"btn btn-default\"\n                  @click=\"saveName\"\n              >\n                <i :class=\"`fas fa-${saved ? 'check' : 'save'}`\" />\n              </button>\n            </span>\n          </div>\n          <div v-else>\n            {{ file.name }}\n          </div>\n          <small><span class=\"text-nowrap\">{{ humanizedSize(file.size) }}</span> ({{ file.mimetype }})</small>\n        </h4>\n      </div>\n      <!-- actions -->\n      <div\n          class=\"media-right text-right\"\n          :style=\"{'min-width': isViewableDocument ? '9.5em' : '7em'}\"\n      >\n        <div class=\"btn-group\">\n          <a\n              v-if=\"isViewableDocument\"\n              class=\"btn btn-default\"\n              data-toggle=\"modal\"\n              :data-target=\"`#modal-${formattedValue}`\"\n          >\n            <span class=\"fas fa-eye\" />\n          </a>\n          <a\n              class=\"btn btn-default\"\n              target=\"_blank\"\n              :href=\"`${file.url}?dl=1`\"\n          >\n            <span class=\"fas fa-download\" />\n          </a>\n          <button\n              v-if=\"isEditable\"\n              class=\"btn btn-danger\"\n              type=\"button\"\n              @click=\"$emit('delete')\"\n          >\n            <span class=\"fas fa-trash-alt\" />\n          </button>\n        </div>\n      </div>\n      <ViewingModal\n          v-if=\"isViewableDocument\"\n          :id=\"formattedValue\"\n          :file=\"file\"\n          :is-editable=\"isEditable\"\n          :value=\"value\"\n          :base-url=\"baseUrl\"\n          @update-token=\"$emit('updateToken', $event)\"\n      />\n    </template>\n  </li>\n</template>\n\n<script lang=\"ts\">\n/**\n * This component's goal is to view an uploaded file and edit it\n */\nimport {doRequest, humanizedSize} from '../utils';\nimport ViewingModal from './ViewingModal.vue';\nimport {defineComponent} from 'vue';\nimport type {FileUpload} from \"../interfaces\";\n\nexport default defineComponent({\n  name: 'ViewEntry',\n  components: {ViewingModal},\n  props: {\n    value: {\n      type: String,\n      required: true,\n    },\n    id: {\n      type: String,\n      required: true,\n    },\n    baseUrl: {\n      type: String,\n      required: true,\n    },\n    isEditable: {\n      type: Boolean,\n      default: true,\n    },\n    editableFilename: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: {\n    updateToken(token: string) {\n      return token.length > 0;\n    },\n    delete() {\n      return true;\n    },\n  },\n  data() {\n    return {\n      file: null as FileUpload | null,\n      loading: true,\n      error: '',\n      name: '',\n      extension: '',\n      saved: false,\n    };\n  },\n  computed: {\n    isImage: function () {\n      return this.file?.mimetype.split('/')[0] === 'image';\n    },\n    isViewableDocument: function () {\n      const mimetype = (this.file as FileUpload).mimetype;\n      return mimetype.split('/')[0] === 'image' || mimetype === 'application/pdf';\n    },\n    formattedValue: function () {\n      return this.value.replace(/:/g, '-');\n    },\n    fullName: {\n      // The full name is composed of the file name and extension (if specified)\n      get() {\n        return `${this.name}${this.extension}`;\n      },\n      set: function (newValue: string) {\n        const splitName = /^(.+)(\\.[^.]+)$/.exec(newValue);\n        if (splitName?.length === 3) {\n          this.name = splitName[1];\n          this.extension = splitName[2];\n        } else {\n          this.name = newValue;\n          this.extension = '';\n        }\n      },\n    },\n  },\n  watch: {\n    value: 'getFile',\n  },\n  mounted() {\n    void this.getFile();\n  },\n  methods: {\n    humanizedSize,\n    getFile: async function () {\n      if (this.value === 'FileInfectedException') {\n        this.error = this.$t('view_entry.file_infected');\n      } else {\n        try {\n          this.file = await doRequest(`${this.baseUrl}metadata/${this.value}`) as FileUpload;\n          this.fullName = this.file.name;\n        } catch (e) {\n          this.error = (e as Error).message;\n        }\n      }\n      this.loading = false;\n    },\n    saveName: async function () {\n      try {\n        await doRequest(`${this.baseUrl}change-metadata/${this.value}`, {\n          method: 'POST',\n          body: JSON.stringify({name: this.fullName}),\n        });\n        this.saved = true;\n        (this.file as FileUpload).name = this.fullName;\n      } catch (e) {\n        this.error = (e as Error).message;\n      }\n    },\n  },\n});\n</script>\n"],"names":["_sfc_main","defineComponent","ViewingModal","token","_a","mimetype","newValue","splitName","humanizedSize","doRequest","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_7","_hoisted_9","_createElementVNode","_hoisted_11","_hoisted_15","_hoisted_16","_hoisted_18","_hoisted_19","_hoisted_21","_hoisted_23","_hoisted_26","_hoisted_28","_resolveComponent","_openBlock","_createElementBlock","_hoisted_1","_ctx","_Fragment","_hoisted_6","_toDisplayString","_hoisted_8","_createCommentVNode","_hoisted_13","_hoisted_14","_withDirectives","_cache","$event","_vModelText","_hoisted_17","args","_hoisted_20","_normalizeStyle","_hoisted_24","_hoisted_22","_hoisted_27","_hoisted_25","_createBlock","_component_ViewingModal"],"mappings":"oUAmKA,MAAAA,EAAeC,EAAgB,CAC7B,KAAM,YACN,WAAY,CAAC,aAAAC,CAAY,EACzB,MAAO,CACL,MAAO,CACL,KAAM,OACN,SAAU,EACZ,EACA,GAAI,CACF,KAAM,OACN,SAAU,EACZ,EACA,QAAS,CACP,KAAM,OACN,SAAU,EACZ,EACA,WAAY,CACV,KAAM,QACN,QAAS,EACX,EACA,iBAAkB,CAChB,KAAM,QACN,QAAS,EACX,CACF,EACA,MAAO,CACL,YAAYC,EAAe,CACzB,OAAOA,EAAM,OAAS,CACxB,EACA,QAAS,CACA,MAAA,EACT,CACF,EACA,MAAO,CACE,MAAA,CACL,KAAM,KACN,QAAS,GACT,MAAO,GACP,KAAM,GACN,UAAW,GACX,MAAO,EAAA,CAEX,EACA,SAAU,CACR,QAAS,UAAY,OACnB,QAAOC,EAAA,KAAK,OAAL,YAAAA,EAAW,SAAS,MAAM,KAAK,MAAO,OAC/C,EACA,mBAAoB,UAAY,CACxB,MAAAC,EAAY,KAAK,KAAoB,SAC3C,OAAOA,EAAS,MAAM,GAAG,EAAE,CAAC,IAAM,SAAWA,IAAa,iBAC5D,EACA,eAAgB,UAAY,CAC1B,OAAO,KAAK,MAAM,QAAQ,KAAM,GAAG,CACrC,EACA,SAAU,CAER,KAAM,CACG,MAAA,GAAG,KAAK,OAAO,KAAK,WAC7B,EACA,IAAK,SAAUC,EAAkB,CACzB,MAAAC,EAAY,kBAAkB,KAAKD,CAAQ,GAC7CC,GAAA,YAAAA,EAAW,UAAW,GACnB,KAAA,KAAOA,EAAU,CAAC,EAClB,KAAA,UAAYA,EAAU,CAAC,IAE5B,KAAK,KAAOD,EACZ,KAAK,UAAY,GAErB,CACF,CACF,EACA,MAAO,CACL,MAAO,SACT,EACA,SAAU,CACH,KAAK,SACZ,EACA,QAAS,CACP,cAAAE,EACA,QAAS,gBAAkB,CACrB,GAAA,KAAK,QAAU,wBACZ,KAAA,MAAQ,KAAK,GAAG,0BAA0B,MAE3C,IAAA,CACF,KAAK,KAAO,MAAMC,EAAU,GAAG,KAAK,mBAAmB,KAAK,OAAO,EAC9D,KAAA,SAAW,KAAK,KAAK,WACnB,GACP,KAAK,MAAS,EAAY,OAC5B,CAEF,KAAK,QAAU,EACjB,EACA,SAAU,gBAAkB,CACtB,GAAA,CACF,MAAMA,EAAU,GAAG,KAAK,0BAA0B,KAAK,QAAS,CAC9D,OAAQ,OACR,KAAM,KAAK,UAAU,CAAC,KAAM,KAAK,SAAS,CAAA,CAC3C,EACD,KAAK,MAAQ,GACZ,KAAK,KAAoB,KAAO,KAAK,eAC/B,GACP,KAAK,MAAS,EAAY,OAC5B,CACF,CACF,CACF,CAAC,oBA7OOC,EAAM,CAAA,IAAA,sBAIFC,EAAM,CAAA,MAAA,YACFC,EAAC,CACL,MAAA,2CACA,KAAA,cACA,gBAAc,IACb,gBAAO,IAAA,gBAAA,MAEJ,MAAA,CAAA,MAAA,MAAA,MAOF,MAAM,cAET,MAAM,cAOPC,EAAA,CAAA,MAAA,kDAAAC,EAAiCC,EAAA,OAAA,CAAA,MAAA,oBAAA,KAAA,EAAA,QAQjCC,EAAM,CAAA,IAAA,+BAUC,KAAC,mDAGJC,EAAM,CAAA,IAAA,uBAUJC,EAAM,CAAA,IAAA,yDAkBOC,EAAA,CAAA,UAAA,EAQhBC,EAAA,CAAA,IAAK,2BAONC,EAAA,CAAA,MAAA,+BAAAC,EAA2BP,EAAA,OAAA,CAAA,MAAA,cAAA,KAAA,EAAA,mBAO3BQ,EAAgCR,EAAA,OAAA,CAAA,MAAA,mBAAA,KAAA,EAAA,QAQhCS,EAAiCT,EAAA,OAAA,CAAA,MAAA,oBAAA,KAAA,EAAA,6CA9G3CU,EA4HK,cAAA,EA1HH,OAAAC,EAAA,EAAAC,EAgBM,KAhBNC,EAgBM,CAAAC,EAZJ,aAUQF,EAAA,MAAAjB,EAAA,CAAAK,EADJ,MAA2DJ,EAA3D,CAAAI,EAAA,MAAAH,EAAA,8CAKe,CAAA,CAAA,CAAA,GAAAiB,EACnB,SAC+D,EAAAF,EAAAG,EAAA,CAAA,IAAA,GAAA,CAAAf,EAAA,MAAAgB,EAAA,CAE/DhB,EASM,OATNF,EASMmB,EAAAH,EAAA,GAAA,QAAA,CAAA,MAAAA,EAAA,KAAA,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,EARJd,EAAA,MAAAkB,EAAA,CAAAJ,EAAA,YAAAH,IAE0BC,EAAA,SAAA,CACtB,IAAI,EACH,MAAK,iBAAA,KAAA,gEAOO,CAAA,CAET,EAAA,EAAA,GAAAE,EAAA,MAAAH,EAAA,EAAAC,EADVG,EAUM,CAVN,IAAA,GAAA,CAAAD,EAIE,aACsCF,EAAA,MAAAX,EAAA,CACpBD,EAAA,MAAA,CACb,MAAK,6BACN,IAAKc,EAAC,KAAI,IAAA,IAAAA,EAAA,KAAA,0BAGhB,CAAA,GACEK,EAgCK,GAhCL,EAAA,EAAAnB,EAEsB,MAAIoB,EAAA,CADxBpB,EAAA,KAAAqB,EAAA,CAIEP,EAAA,YAAAA,EAAA,kBAAAH,EAAA,EAAAC,EAAA,MAAAV,EAAA,CAEeoB,EAAAtB,EAAA,QAAA,CACX,sBAAoBuB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAAAV,EAAA,KAAAU,GACnB,KAAA,OAAA,MAAA,yBAHQ,CAAI,IAAAD,EAAA,CAAA,EAAAC,GAAAV,EAAA,MAAA,GAAA,EAAA,KAAA,GAAA,EAAA,CAMP,CAASW,EAAAX,EAAA,IAAA,CAAA,CAAA,EAKnBA,EAAA,WAAAH,EAAA,EAAAC,EASO,4BARLO,EAOS,GAAA,EAAA,EANQnB,EAAA,OAAA0B,EAAA,CAAA1B,EACF,SAAS,CACpB,KAAK,SACJ,SAAKc,EAAA,KAAA,OAAAA,EAAA,SAAA,MAAA,kBAER,QAAmDS,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,IAAAI,IAAAb,EAAA,UAAAA,EAAA,SAAA,GAAAa,CAAA,EAAA,EAAA,oEAOzD,CAAA,IAAOhB,EAA+D,EAAAC,EAAA,MAAAP,EAAAY,EAAlCH,EAAc,KAAA,IAAK,EAAI,CAAA,GAAAd,EAAW,QAAE,KAAA,CAAAA,EAAA,OAAA4B,EAAAX,EAAAH,EAAA,cAAAA,EAAA,KAAA,IAAA,CAAA,EAAA,CAAA,oCAI5E,CAAA,CAAA,CAAA,EAEUd,EAAA,MAAA,CAAA,MAAA,yBAER,MAAA6B,EAwBM,aAxBNf,EAwBM,mBAAA,QAAA,MAAA,CAAA,EAAA,CAvBJd,EAAA,MAAAM,EAAA,CAAAQ,EAAA,oBAAAH,IAE2BC,EAAA,IAAA,CACvB,IAAA,EACC,MAAA,kBAAA,cAAA,oDAUDkB,EAAA,EAAAC,CAAA,GALAZ,EAAM,GAAiB,EAAA,EACRnB,EAAA,IAAA,CACd,MAAI,kBAAA,OAAA,SAKC,KAAU,GAAAc,EAAA,KAAA,UAAA,EADpBkB,EAAA,EAAAC,CAAA,EAAAnB,EAAA,YAAAH,IAE0BC,EAAA,SAAA,CACtB,IAAI,EACH,MAAK,iBAAA,KAAA,gEAOJ,CAAA,CAAA,EAAA,CAAA,4BACasB,EAAAC,EAAA,CAClB,IAAI,EACJ,GAAArB,EAAA,eACA,KAAKA,EAAE,KACP,cAAUA,EAAA,WACV,MAAAA,EAAA,MAAA,WAAAA,EAAA"}