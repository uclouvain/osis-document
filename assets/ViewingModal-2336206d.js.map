{"version":3,"file":"ViewingModal-2336206d.js","sources":["../../frontend/components/ViewingModal.vue"],"sourcesContent":["<!--\n  -\n  -   OSIS stands for Open Student Information System. It's an application\n  -   designed to manage the core business of higher education institutions,\n  -   such as universities, faculties, institutes and professional schools.\n  -   The core business involves the administration of students, teachers,\n  -   courses, programs and so on.\n  -\n  -   Copyright (C) 2015-2021 UniversitÃ© catholique de Louvain (http://www.uclouvain.be)\n  -\n  -   This program is free software: you can redistribute it and/or modify\n  -   it under the terms of the GNU General Public License as published by\n  -   the Free Software Foundation, either version 3 of the License, or\n  -   (at your option) any later version.\n  -\n  -   This program is distributed in the hope that it will be useful,\n  -   but WITHOUT ANY WARRANTY; without even the implied warranty of\n  -   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  -   GNU General Public License for more details.\n  -\n  -   A copy of this license - GNU General Public License - is available\n  -   at the root of the source code of this program.  If not,\n  -   see http://www.gnu.org/licenses/.\n  -\n  -->\n\n<template>\n  <div\n      :id=\"`modal-${id}`\"\n      class=\"modal fade\"\n      tabindex=\"-1\"\n      role=\"dialog\"\n  >\n    <div\n        class=\"modal-dialog modal-lg\"\n        role=\"document\"\n    >\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <button\n              type=\"button\"\n              class=\"close\"\n              data-dismiss=\"modal\"\n              :aria-label=\"$t('view_entry.close')\"\n          >\n            <span aria-hidden=\"true\">&times;</span>\n          </button>\n          <h4 class=\"modal-title\">\n            {{ file.name }}\n          </h4>\n        </div>\n        <div\n            ref=\"modal\"\n            class=\"modal-body\"\n            style=\"transition: 500ms; overflow: hidden; max-width: 100%\"\n            :style=\"{height: modalHeight}\"\n        >\n          <img\n              v-if=\"isImage\"\n              ref=\"img\"\n              :src=\"file.url\"\n              :alt=\"file.name\"\n              class=\"img-responsive\"\n              style=\"transition: 500ms; transform-origin: top center; margin: 0 auto;\"\n              :style=\"imageStyle\"\n              @load=\"imageLoaded($event.target as HTMLImageElement)\"\n          >\n          <div\n              v-else\n              class=\"embed-responsive embed-responsive-16by9\"\n          >\n            <object\n                :data=\"file.url\"\n                type=\"application/pdf\"\n                class=\"embed-responsive-item\"\n            >\n              <embed\n                  :src=\"file.url\"\n                  type=\"application/pdf\"\n              >\n            </object>\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n          <div class=\"row\">\n            <div\n                v-if=\"isImage && isEditable\"\n                class=\"col-sm-10 text-left\"\n            >\n              <button\n                  type=\"button\"\n                  class=\"btn btn-default\"\n                  @click=\"rotation -= 90\"\n              >\n                <i class=\"fas fa-undo\" />\n              </button>\n              <button\n                  type=\"button\"\n                  class=\"btn btn-default\"\n                  @click=\"rotation += 90\"\n              >\n                <i class=\"fas fa-redo\" />\n              </button>\n              <button\n                  type=\"button\"\n                  class=\"btn btn-default\"\n                  :disabled=\"!isRotated\"\n                  @click=\"saveRotation\"\n              >\n                <i :class=\"`fas fa-${saved ? 'check' : 'save'}`\" />\n                {{ $t('view_entry.save') }}\n              </button>\n              <span\n                  v-if=\"error\"\n                  class=\"text-danger\"\n              >\n                {{ $t('error', { error }) }}\n              </span>\n            </div>\n            <div class=\"col-sm-2 pull-right\">\n              <button\n                  type=\"button\"\n                  class=\"btn btn-default\"\n                  data-dismiss=\"modal\"\n              >\n                {{ $t('view_entry.close') }}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {defineComponent, nextTick} from 'vue';\nimport type {PropType} from 'vue';\nimport type {FileUpload, TokenReponse} from '../interfaces';\nimport {doRequest} from \"../utils\";\n\nexport default defineComponent({\n  name: 'ViewingModal',\n  props: {\n    baseUrl: {\n      type: String,\n      required: true,\n    },\n    value: {\n      type: String,\n      required: true,\n    },\n    id: {\n      type: String,\n      required: true,\n    },\n    file: {\n      type: Object as PropType<FileUpload>,\n      required: true,\n    },\n    isEditable: {\n      type: Boolean,\n      default: true,\n    },\n    openOnMount: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: {\n    updateToken(token: string) {\n      return token.length > 0;\n    },\n  },\n  data: function () {\n    return {\n      // Image rotation set by user\n      rotation: 0,\n      // Original image dimensions (filled once loaded)\n      originalHeight: null as number | null,\n      originalWidth: null as number | null,\n      // Programmatically controlled dimensions for modal\n      modalHeight: 'auto',\n      modalWidth: 'auto',\n      error: '',\n      saved: false,\n    };\n  },\n  computed: {\n    isImage: function () {\n      return this.file.mimetype.split('/')[0] === 'image';\n    },\n    imageStyle: function () {\n      let transform = `rotate(${this.rotation}deg)`;\n      if (this.isQuarterRotated) {\n        transform += ` translate(${this.isRotated90CounterClockwise ? '-50%' : '50%'}, -50%)`;\n      } else if (this.isRotated) {\n        transform += ` translate(0, -100%)`;\n      }\n      // When image is portrait, constraint the rotated image height (which is width) to modal width\n      const modal = this.$refs.modal as HTMLDivElement;\n      const height = (this.originalHeight && this.isQuarterRotated && modal.clientWidth < this.originalHeight)\n          ? `${modal.clientWidth - 30}px`\n          : 'auto';\n      return {transform, height};\n    },\n    isRotated: function () {\n      return this.rotation % 360;\n    },\n    isQuarterRotated: function () {\n      // Check if the image is rotated at 90 or -90 degrees\n      return this.rotation % 180;\n    },\n    isRotated90CounterClockwise: function () {\n      // Check if the image is rotated at -90 degrees\n      return [-90, 270].includes(this.rotation % 360);\n    },\n  },\n  watch: {\n    rotation: 'changeModalHeight',\n  },\n  mounted() {\n    // The modal may be loaded hidden, thus the image has no dimensions, use bootstrap event\n    jQuery(this.$el).on('shown.bs.modal', () => {\n      if (!this.originalHeight) {\n        void this.imageLoaded(this.$refs.img as HTMLImageElement);\n      }\n      this.changeModalHeight();\n    });\n    if (this.openOnMount) {\n      jQuery(this.$el).modal('show');\n    }\n  },\n  beforeUnmount() {\n    jQuery(this.$el).modal('hide');\n  },\n  methods: {\n    imageLoaded: async function (img: HTMLImageElement) {\n      // The image is loaded, better wait for next rendering tick\n      await nextTick();\n      this.originalHeight = img.clientHeight;\n      this.originalWidth = img.clientWidth;\n      this.changeModalHeight();\n    },\n    changeModalHeight: function () {\n      if (!this.originalWidth || !this.originalHeight) return 'auto';  // Image is not yet loaded\n      const modal = this.$refs.modal as HTMLDivElement;\n      if (this.isQuarterRotated && modal.clientWidth < this.originalHeight) {\n        // Handle case when image is too tall for width (portrait)\n        this.modalHeight = `${modal.clientWidth * this.originalWidth / this.originalHeight + 30}px`;\n      } else {\n        this.modalHeight = `${(this.isQuarterRotated ? this.originalWidth : this.originalHeight) + 30}px`;\n      }\n    },\n    saveRotation: async function () {\n      try {\n        const data = await doRequest(`${this.baseUrl}rotate-image/${this.value}`, {\n          method: 'POST',\n          body: JSON.stringify({rotate: this.rotation}),\n        }) as TokenReponse;\n        this.saved = true;\n        this.rotation = 0;\n        this.$emit('updateToken', data.token);\n        this.error = '';\n      } catch (e) {\n        this.error = (e as Error).message;\n      }\n    },\n  },\n});\n</script>\n"],"names":["_sfc_main","defineComponent","token","transform","modal","height","img","nextTick","data","doRequest","_hoisted_1","_hoisted_2","_hoisted_4","_hoisted_6","_createElementVNode","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_15","_hoisted_16","_hoisted_18","_hoisted_21","_hoisted_22","_hoisted_23","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","_openBlock","_createElementBlock","_hoisted_3","_hoisted_7","_hoisted_5","_hoisted_8","_toDisplayString","_normalizeStyle","$event","_hoisted_9","_hoisted_13","_hoisted_14","_hoisted_17","_hoisted_19","args","_normalizeClass","_createTextVNode","_hoisted_20","_createCommentVNode","__name"],"mappings":"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"}