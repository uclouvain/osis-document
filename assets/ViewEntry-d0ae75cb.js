var p=Object.defineProperty;var r=(e,s)=>p(e,"name",{value:s,configurable:!0});import{V as h,h as c,d,_ as g}from"./ViewingModal-13dc53c4.js";import{d as b,o as a,a as i,b as t,t as o,F as u,e as l,w as y,v,g as k,f as _,n as $,i as w,j as V}from"./vue.esm-bundler-f0fdd64c.js";const m=b({name:"ViewEntry",components:{ViewingModal:h},props:{value:{type:String,required:!0},id:{type:String,required:!0},baseUrl:{type:String,required:!0},isEditable:{type:Boolean,default:!0},editableFilename:{type:Boolean,default:!0}},emits:{updateToken(e){return e.length>0},delete(){return!0}},data(){return{file:null,loading:!0,error:"",name:"",extension:"",saved:!1}},computed:{isImage:function(){var e;return((e=this.file)==null?void 0:e.mimetype.split("/")[0])==="image"},isViewableDocument:function(){const e=this.file.mimetype;return e.split("/")[0]==="image"||e==="application/pdf"},formattedValue:function(){return this.value.replace(/:/g,"-")},fullName:{get(){return`${this.name}${this.extension}`},set:function(e){const s=/^(.+)(\.[^.]+)$/.exec(e);(s==null?void 0:s.length)===3?(this.name=s[1],this.extension=s[2]):(this.name=e,this.extension="")}}},watch:{value:"getFile"},mounted(){this.getFile()},methods:{humanizedSize:c,getFile:async function(){if(this.value==="FileInfectedException")this.error=this.$t("view_entry.file_infected");else try{this.file=await d(`${this.baseUrl}metadata/${this.value}`),this.fullName=this.file.name}catch(e){this.error=e.message}this.loading=!1},saveName:async function(){try{await d(`${this.baseUrl}change-metadata/${this.value}`,{method:"POST",body:JSON.stringify({name:this.fullName})}),this.saved=!0,this.file.name=this.fullName}catch(e){this.error=e.message}}}}),N={class:"media"},E={key:0,class:"media-body"},F={class:"progress"},S={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},q={class:"sr-only"},z={class:"media-body"},C={class:"text-danger"},T={class:"media-right text-right"},U=t("span",{class:"fas fa-trash-alt"},null,-1),B=[U],D={key:0,class:"media-left"},I=["src","alt"],M={class:"media-body"},j={class:"media-heading"},O={key:0,class:"input-group"},J={key:0,class:"input-group-addon"},P={class:"input-group-btn"},R=["disabled"],A={key:1},G={class:"text-nowrap"},H={class:"btn-group"},K=["data-target"],L=t("span",{class:"fas fa-eye"},null,-1),Q=[L],W=["href"],X=t("span",{class:"fas fa-download"},null,-1),Y=[X],Z=t("span",{class:"fas fa-trash-alt"},null,-1),x=[Z];function ee(e,s,te,se,ae,ie){const f=V("ViewingModal");return a(),i("li",N,[e.loading?(a(),i("div",E,[t("div",F,[t("div",S,[t("span",q,o(e.$t("view_entry.loading")),1)])])])):e.error?(a(),i(u,{key:1},[t("div",z,[t("span",C,o(e.$t("error",{error:e.error})),1)]),t("div",T,[e.isEditable?(a(),i("button",{key:0,class:"btn btn-danger",type:"button",onClick:s[0]||(s[0]=n=>e.$emit("delete"))},B)):l("",!0)])],64)):e.file?(a(),i(u,{key:2},[e.isImage?(a(),i("div",D,[t("img",{class:"media-object img-thumbnail",src:e.file.url,alt:e.file.name,width:"80"},null,8,I)])):l("",!0),t("div",M,[t("h4",j,[e.isEditable&&e.editableFilename?(a(),i("div",O,[y(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.name=n),type:"text",class:"form-control",onInput:s[2]||(s[2]=n=>e.saved=!1)},null,544),[[v,e.name]]),e.extension?(a(),i("span",J,o(e.extension),1)):l("",!0),t("span",P,[t("button",{type:"button",disabled:e.file.name===e.fullName,class:"btn btn-default",onClick:s[3]||(s[3]=(...n)=>e.saveName&&e.saveName(...n))},[t("i",{class:k(`fas fa-${e.saved?"check":"save"}`)},null,2)],8,R)])])):(a(),i("div",A,o(e.file.name),1)),t("small",null,[t("span",G,o(e.humanizedSize(e.file.size)),1),_(" ("+o(e.file.mimetype)+")",1)])])]),t("div",{class:"media-right text-right",style:$({"min-width":e.isViewableDocument?"9.5em":"7em"})},[t("div",H,[e.isViewableDocument?(a(),i("a",{key:0,class:"btn btn-default","data-toggle":"modal","data-target":`#modal-${e.formattedValue}`},Q,8,K)):l("",!0),t("a",{class:"btn btn-default",target:"_blank",href:`${e.file.url}?dl=1`},Y,8,W),e.isEditable?(a(),i("button",{key:1,class:"btn btn-danger",type:"button",onClick:s[4]||(s[4]=n=>e.$emit("delete"))},x)):l("",!0)])],4),e.isViewableDocument?(a(),w(f,{key:1,id:e.formattedValue,file:e.file,"is-editable":e.isEditable,value:e.value,"base-url":e.baseUrl,onUpdateToken:s[5]||(s[5]=n=>e.$emit("updateToken",n))},null,8,["id","file","is-editable","value","base-url"])):l("",!0)],64)):l("",!0)])}r(ee,"_sfc_render");const re=g(m,[["render",ee]]);m.__docgenInfo={displayName:"ViewEntry",exportName:"default",description:"",tags:{},props:[{name:"value",type:{name:"string"},required:!0},{name:"id",type:{name:"string"},required:!0},{name:"baseUrl",type:{name:"string"},required:!0},{name:"isEditable",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"editableFilename",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}}],events:[{name:"delete"},{name:"updateToken"}]};export{re as V};
//# sourceMappingURL=ViewEntry-d0ae75cb.js.map
