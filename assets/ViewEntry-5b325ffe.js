var p=Object.defineProperty;var d=(e,s)=>p(e,"name",{value:s,configurable:!0});import{h as c,d as l,_ as f}from"./plugin-vueexport-helper-dbf55845.js";import{V as v}from"./ViewingModal-2336206d.js";import{d as y,o as a,a as i,b as t,t as o,k as u,F as m,i as r,l as b,v as P,n as w,e as k,g as _,j as $}from"./vue.esm-bundler-398966a3.js";const g=y({name:"ViewEntry",components:{ViewingModal:v},props:{value:{type:String,required:!0},id:{type:String,required:!0},baseUrl:{type:String,required:!0},isEditable:{type:Boolean,default:!0},editableFilename:{type:Boolean,default:!0},getProgressUrl:{type:String,default:""},postProcessStatus:{type:String,default:""},baseUuid:{type:String,default:""},wantedPostProcess:{type:String,default:""}},emits:{updateToken(e){return e.length>0},delete(){return!0}},data(){return{file:null,loading:!0,inPostProcessing:!1,postProcessingProgress:0,error:"",name:"",extension:"",saved:!1,intervalProgress:setInterval(()=>{},3e5),getRemoteTokenResponse:{token:""}}},computed:{isImage:function(){var e;return((e=this.file)==null?void 0:e.mimetype.split("/")[0])==="image"},isViewableDocument:function(){const e=this.file.mimetype;return e.split("/")[0]==="image"||e==="application/pdf"},formattedValue:function(){return this.value.replace(/:/g,"-")},fullName:{get(){return`${this.name}${this.extension}`},set:function(e){const s=/^(.+)(\.[^.]+)$/.exec(e);(s==null?void 0:s.length)===3?(this.name=s[1],this.extension=s[2]):(this.name=e,this.extension="")}}},watch:{value:"getFile"},mounted(){this.getFile()},updated(){this.inPostProcessing&&((this.getProgressUrl!==""||this.getProgressUrl!==void 0)&&this.postProcessingProgress!==100&&(clearInterval(this.intervalProgress),this.intervalProgress=setInterval(()=>{this.getProgressPostProcessing()},3e3)),this.postProcessingProgress===100&&(clearInterval(this.intervalProgress),this.inPostProcessing=!1,this.getFile()))},unmounted(){clearInterval(this.intervalProgress)},methods:{humanizedSize:c,getFile:async function(){if(this.value==="FileInfectedException")this.error=this.$t("view_entry.file_infected");else if(this.value===""&&this.postProcessingProgress!==100)this.inPostProcessing=!0,await this.getProgressPostProcessing();else{if(this.value===""){let s=JSON.stringify({uuid:this.baseUuid});(this.wantedPostProcess===""||this.wantedPostProcess===void 0)&&(s=JSON.stringify({uuid:this.baseUuid,wanted_post_process:this.wantedPostProcess})),this.getRemoteTokenResponse=await l(`${this.baseUrl}read-token/${this.baseUuid}`,{method:"POST",body:s})}const e=this.getRemoteTokenResponse.token!==""?`${this.baseUrl}metadata/${this.getRemoteTokenResponse.token}`:`${this.baseUrl}metadata/${this.value}`;try{this.file=await l(e),this.fullName=this.file.name}catch(s){this.error=s.message}}this.loading=!1,console.log("loading est false")},getProgressPostProcessing:async function(){/* istanbul ignore if -- @preserve */if(this.postProcessingProgress!==100&&this.getProgressUrl!=="")try{let e="";this.wantedPostProcess?e=this.getProgressUrl+"?wanted_post_process="+this.wantedPostProcess:e=this.getProgressUrl;const s=await l(`${e}`,{method:"GET"});this.postProcessingProgress=s.progress}catch(e){this.error=e.message}},saveName:async function(){try{await l(`${this.baseUrl}change-metadata/${this.value}`,{method:"POST",body:JSON.stringify({name:this.fullName})}),this.saved=!0,this.file.name=this.fullName}catch(e){this.error=e.message}}}}),V={class:"media"},U={key:0,class:"media-body"},S={class:"progress"},N={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},E={class:"sr-only"},T={key:1,class:"media-body"},F={class:"progress",style:{"text-align":"center"}},I={class:"sr-only"},R={class:"align-items-center"},q={class:"media-body"},z={class:"text-danger"},C={class:"media-right text-right"},B=t("span",{class:"fas fa-trash-alt"},null,-1),D=[B],O={key:0,class:"media-left"},M=["src","alt"],J={class:"media-body"},j={class:"media-heading"},A={key:0,class:"input-group"},G={key:0,class:"input-group-addon"},H={class:"input-group-btn"},K=["disabled"],L={key:1},Q={class:"text-nowrap"},W={class:"btn-group"},X=["data-target"],Y=t("span",{class:"fas fa-eye"},null,-1),Z=[Y],x=["href"],ee=t("span",{class:"fas fa-download"},null,-1),se=[ee],te=t("span",{class:"fas fa-trash-alt"},null,-1),ae=[te];function ie(e,s,ne,oe,re,le){const h=$("ViewingModal");return a(),i("li",V,[e.loading?(a(),i("div",U,[t("div",S,[t("div",N,[t("span",E,o(e.$t("view_entry.loading")),1)])])])):e.inPostProcessing?(a(),i("div",T,[t("div",F,[t("div",{class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:u({width:e.postProcessingProgress.toString()+"%"})},[t("span",I,o(e.$t("view_entry.loading")),1)],4),t("span",R,"Avancement du post processing : "+o(e.postProcessingProgress)+" %",1)])])):e.error?(a(),i(m,{key:2},[t("div",q,[t("span",z,o(e.$t("error",{error:e.error})),1)]),t("div",C,[e.isEditable?(a(),i("button",{key:0,class:"btn btn-danger",type:"button",onClick:s[0]||(s[0]=n=>e.$emit("delete"))},D)):r("",!0)])],64)):e.file?(a(),i(m,{key:3},[e.isImage?(a(),i("div",O,[t("img",{class:"media-object img-thumbnail",src:e.file.url,alt:e.file.name,width:"80"},null,8,M)])):r("",!0),t("div",J,[t("h4",j,[e.isEditable&&e.editableFilename?(a(),i("div",A,[b(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.name=n),type:"text",class:"form-control",onInput:s[2]||(s[2]=n=>e.saved=!1)},null,544),[[P,e.name]]),e.extension?(a(),i("span",G,o(e.extension),1)):r("",!0),t("span",H,[t("button",{type:"button",disabled:e.file.name===e.fullName,class:"btn btn-default",onClick:s[3]||(s[3]=(...n)=>e.saveName&&e.saveName(...n))},[t("i",{class:w(`fas fa-${e.saved?"check":"save"}`)},null,2)],8,K)])])):(a(),i("div",L,o(e.file.name),1)),t("small",null,[t("span",Q,o(e.humanizedSize(e.file.size)),1),k(" ("+o(e.file.mimetype)+")",1)])])]),t("div",{class:"media-right text-right",style:u({"min-width":e.isViewableDocument?"9.5em":"7em"})},[t("div",W,[e.isViewableDocument?(a(),i("a",{key:0,class:"btn btn-default","data-toggle":"modal","data-target":`#modal-${e.formattedValue}`},Z,8,X)):r("",!0),t("a",{class:"btn btn-default",target:"_blank",href:`${e.file.url}?dl=1`},se,8,x),e.isEditable?(a(),i("button",{key:1,class:"btn btn-danger",type:"button",onClick:s[4]||(s[4]=n=>e.$emit("delete"))},ae)):r("",!0)])],4),e.isViewableDocument?(a(),_(h,{key:1,id:e.formattedValue,file:e.file,"is-editable":e.isEditable,value:e.value,"base-url":e.baseUrl,onUpdateToken:s[5]||(s[5]=n=>e.$emit("updateToken",n))},null,8,["id","file","is-editable","value","base-url"])):r("",!0)],64)):r("",!0)])}d(ie,"_sfc_render");const he=f(g,[["render",ie]]);g.__docgenInfo={displayName:"ViewEntry",exportName:"default",description:"",tags:{},props:[{name:"value",type:{name:"string"},required:!0},{name:"id",type:{name:"string"},required:!0},{name:"baseUrl",type:{name:"string"},required:!0},{name:"isEditable",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"editableFilename",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"getProgressUrl",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"postProcessStatus",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"baseUuid",type:{name:"string"},defaultValue:{func:!1,value:'""'}},{name:"wantedPostProcess",type:{name:"string"},defaultValue:{func:!1,value:'""'}}],events:[{name:"delete"},{name:"updateToken"}],sourceFiles:["/home/runner/work/osis-document/osis-document/frontend/components/ViewEntry.vue"]};export{he as V};
//# sourceMappingURL=ViewEntry-5b325ffe.js.map
